\documentclass[a4paper]{amsproc}
\renewcommand\labelenumi{(\roman{enumi})}
\renewcommand\theenumi\labelenumi
\title{\textbf{Atomic Topologies in Probability Theory}}

\usepackage{amssymb}
%\usepackage[hyphens]{url} \urlstyle{same}
\usepackage{tikz}
\usepackage{lscape}
\usepackage{mathtools}
\usetikzlibrary{cd}
%\usepackage[dvips]{graphicx} %% Package for inserting illustrations/figures

\theoremstyle{plain}
 \newtheorem{theorem}{Theorem}[section]
 \newtheorem{proposition}[theorem]{Proposition}
 \newtheorem{lemma}[theorem]{Lemma}
 \newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
 \newtheorem{example}[theorem]{Example}
 \newtheorem{definition}[theorem]{Definition}
\theoremstyle{remark}
 \newtheorem{remark}[theorem]{Remark}
 \numberwithin{equation}{section}
 
\newcommand{\ldoub}{[\![ }
\newcommand{\rdoub}{]\!]}

\author{Adam Dauser, Adrian Marti}

\date{}
\begin{document}
\maketitle 

\section{Motivation}

Talk about the challenge of using topos theory for talking about topological phenomena involving completeness properties in a logical way(obviously one can consider sheaves on a space, but it is hard to consider classifying toposes of some kind of space). Completeness kind of provides a solution to this dilemma.

Talk about 'bookkeeping' in probability theory. Nobody cares about the choice of base $\sigma$-algebra, as long as it has good properties. Yet, a $\sigma$-algebra must be chosen. One may try to exploit this by imposing restrictions(of functorial or topological nature) on how statements/sets may depend on the base $\sigma$-algebra. These techniques will lead to an approach to probability theory that works without a choice of $\sigma$-algebra.

\section{Conventions} \label{conventions}

When there is need to be completely formal, the lim and colim operators in our sheaf toposes will not be defined only 'up to isomorphism', but rather taken the to be canonical constructions in sheaf toposes given by sheafifying the (co-)limit taken pointwise is $Set$. In case the sheaf topos is a presheaf topos, we will omit the sheafification step. The same will hold for Kan extensions, as in our examples these are always computed as (co-)limits. When considering what is traditionally thought of different 'representatives' of an isomorphism class given by a limit or colimit, we will formalize this as simply claiming that an object (together with a corresponding universal (co-)cone) \emph{has} a universal property.

This explicit approach clears up some of the confusion that arises when one thinks of e.g. a limit $\text{lim } c_i$ simply as some sort of object defined only up to isomorphism that takes the form of the correct representative of the isomorphism class when convenient. Admittedly, this explicit viewpoint will only be taken in the rare occasion where one needs to prove that certain diagrams involving isomorphisms given by universal properties commute.

For a small category $\mathcal{C}$, we will denote the Yoneda embedding by $y: \mathcal{C} \to Set^{\mathcal{C}^{op}}$. For a morphism $f$ in $\mathcal{C}$, we will denote $y(f)$(also known as postcomposition) by $f_*$.

\section{A combinatorial construction of $\mathfrak{Prob}$}

In this section we will introduce the topos $\mathfrak{Prob}$, by exhibiting a site based on the following category of finite probability spaces.

\begin{definition}
\begin{enumerate}
\item A finite probability space is a finite set $X$ equipped with a map(called probability measure) $\mu: X \to \mathbb{R}_{>0}$ such that \\ $\sum_{x \in X} \mu(x) = 1$.
\item For a finite probability space $(X,\mu)$ and a subset $a \subset X$, we define $\mu(a) := \sum_{x \in a} \mu(x)$.
\item A map of finite probability spaces $(X,\mu) \to (Y,\nu)$ is defined as a map of finite sets $f: X \to Y$ that is measure-preserving, i.e. $\mu(f^{-1}(y)) = \nu(y)$. Denote the category of finite probability spaces by $FinProb$.
\end{enumerate}
\end{definition}

Notice that all maps of finite probability spaces are surjective. Also notice that we do not allow elements of measure zero.

We want to consider the sheaf topos $Sh(FinProb, J_{at})$, where $J_{at}$ denotes the atomic topology. For this to be well-defined, we need to check $FinProb$ satisfies the right Ore condition.

\begin{theorem} \label{pullback_measure}
Given a diagram of finite probability spaces
\[
\begin{tikzcd}
                               & {(X_2,\mu_2)} \arrow[d, "g"] \\
{(X_1, \mu_1)} \arrow[r, "f"'] & {(Y,\mu)}                   
\end{tikzcd},
\]
the pullback of the finite sets carries a probability measure $\nu(x,y) := \frac{\mu_1(x) \mu_2(y)}{\mu(f x)}$ such that
\[
\begin{tikzcd}
{(X_1 \times_Y X_2, \nu)} \arrow[d, "p_1"'] \arrow[r, "p_2"] & {(X_2,\mu_2)} \arrow[d, "g"] \\
{(X_1, \mu_1)} \arrow[r, "f"']                               & {(Y,\mu)}                   
\end{tikzcd}
\]
is a diagram in $FinProb$.

In particular, $FinProb$ satisfies the right Ore condition.
\end{theorem}
\begin{proof}
The only thing to show is that the projections are measure-preserving, since that also implies that $\nu$ is actually a measure. So let $x \in X_1$ and $u := f(x)$.
\begin{align*}
\sum_{(x,y) \in p_1^{-1} x} \nu(x,y) &= \sum_{y \in g^{-1} u} \frac{\mu_1(x)\mu_2(y)}{\mu u} \\
&= \frac{\mu_1 x}{\mu u} \sum_{y \in g^{-1} u} \mu_2 y \\
&= \frac{\mu_2 x}{\mu u} \mu u \\
&= \mu_2 x
\end{align*}
\end{proof}

\begin{lemma}\label{subcanonical} All morphisms in $FinProb$ are regular epimorphisms. In particular $J_{at}$ is a subcanonical topology on $FinProb$.
\end{lemma}
\begin{proof}
We use our construction of the measure on the pullback in \ref{pullback_measure}. Given a morphism $f:(X,\mu)\rightarrow (Y, \nu)$, we have the following fork:
\[
\begin{tikzcd}[column sep=large]
(X \times_Y X, \bar{\mu}) \arrow[r, shift left=2] \arrow[r, shift right] & (X,\mu) \arrow[r, "f", two heads] & (Y,\nu)
\end{tikzcd}
\]
Since this is clearly a coequalizer on the underlying sets, the only thing to show is that the uniquely induced map is measure-preserving. This can either be directly computed or more concisely calculated by using \ref{finprob_equiv}.

The fact that this implies that $J_{at}$ on $FinProb$ is subcanonical is a standard fact, or it can alternatively also seen with \ref{sheaf_condition_weak}, which we will prove soon.
\end{proof}
%More generally;
%\begin{theorem}
%The category $FinProb$ has all multi-limits and connected colimits.
%\end{theorem}
%\begin{proof} We prove it has all coequalizer, pushouts, multi-products and multi-equalizer.
%\begin{enumerate}
%\item Given a diagram as follows, where $\eta'([x])=\eta(x)$ for any equivalence class $[x]$:
%\begin{center}
%\begin{tikzcd}
%{(X,\mu)} \arrow[r, "g"', shift right] \arrow[r, "f", shift left] & {(Y,\nu)} \arrow[r] \arrow[rd] & {(CoEq(f,g),\nu')} \arrow[d, dotted] \\
%                                                                  &                                & {(L,\eta)}                        
%\end{tikzcd} 
%\end{center}
%The induced map by the universal property is measure preserving by \ref{Imnotdumb}. We need only show that $(CoEq(f,g),\nu')$ is a finite probability space. 
%\item Given a diagram as follows, where $\eta'([x])=\eta(x)$ or $\eta'([x])=\lambda(x)$ depending on which set $x$ belongs, for any equivalence class $[x]$. This is a finite probability space ...:
%\begin{center}\begin{tikzcd}
%{(X,\mu)} \arrow[d, "f"'] \arrow[r, "g"]    & {(L,\lambda)} \arrow[rdd, bend left] \arrow[d] &            \\
%{(Y,\nu)} \arrow[rrd, bend right] \arrow[r] & (Y\cup_X L,\mu') \arrow[rd, dotted]                 &            \\
%                                            &                                                & {(M,\eta)}
%\end{tikzcd}\end{center}
%Again the induced map is measure preserving by \ref{Imnotdumb}. Note that this also works for infinite pushouts, since the pushout is also finite given it has a surjection from a finite set.
%\item It has mulit-products. Given a family of finite probability spaces $(X_i,\mu_i)$ and any family of measure preserving maps $f_i:(Y,\nu)\rightarrow (X_i,\mu_i)$, the inverse images of elements of the $X_i$ generate a sub finite probability algebra of $\mathcal{P}(Y)$. We can take $(\tilde{Y},\tilde{\nu})$ the corresponding finite probability space. All the $f_i$ factor through  $(\tilde{Y},\tilde{\nu})$. Take the set of all such finite probability spaces. We claim it is the multi-product of $(X_i,\mu_i)$. This is like painfully obvious.
%\item The same argument applies to all multi-limits.
%\end{enumerate}
%\end{proof}
Now we can introduce the topos that we wish to study in this paper.

\begin{definition}
Define the topos $\mathfrak{Prob}$ to be $Sh(FinProb, J_{at})$.
\end{definition}

Much of this paper is dedicated to finding other equivalent ways of describing $\mathfrak{Prob}$. When we wish to leave the particular description of $\mathfrak{Prob}$ vague, we will use the notation $\mathfrak{Prob}$.

There is some very convenient notation for finite probability spaces emphasizing their combinatorial nature.

\begin{definition}[U-notation] \label{U-notation}
\begin{enumerate}
\item For $r_1, \cdots r_n \in [0,1]$ such that $r_1 + \cdots + r_n = 1$, denote by $U_{r_1 \cdots r_n}$ or simply by $U_{r_i}$ the finite probability space on the set 
\[
\{i | r_i \neq 0 \}
\]
equipped with the measure $\mu(i) = r_i$.
\item When denoting the presheaf $y U_{r_i}$, this will be interpreted as the functor sending a finite probability space $(X,\mu)$ to the set of its partitions $(a_i)$ of the set $X$ with $\mu(a_i) = r_i$.
\item We will use the shorthand $U_r := U_{r,r-1}$ for $r \in [0,1]$ and the functor $y U_r$ will be interpreted as the functor sending a finite probability space to the set of subsets of measure $r$.
\end{enumerate}
\end{definition}

As promised, this is notation for finite probability spaces in the sense that the $U_{r_i}$ form a skeleton of $FinProb$. Part (ii) of the definition is reasonable, since a morphism $(X,\mu) \to U_{r_i}$ of finite probability spaces consists precisely of a partition $(a_i)_i$ of $X$ into subsets of measure $r_i$.

Before continuing, we will derive a better criterion for determining whether a presheaf on $FinProb$ is a sheaf. First, notice that we have the following universal property \footnote{In \cite{caramello_lafforgue} families of objects with these universal properties are called multilimits, see lemma 6.11.} :

\begin{lemma} \label{multipullback}
For a diagram
\[
\begin{tikzcd}
& U_{r_i} \arrow[d, "g"] \\
U_{r'_i} \arrow[r, "f"'] & U_{s_i} ,
\end{tikzcd}
\]
we consider the finite probability spaces $U_{t_{ij}}$ with the projections $p_1: U_{t_{ij}} \to U_{r_i}$, $(x_{ij}) \mapsto (\bigvee_j x_{ij})$ and $p_2: U_{t_{ij}} \to U_{r'_i}$, $(x_{ij}) \mapsto (\bigvee_i x_{ij})$, where the $t_{ij} \geq 0$ are indexed by pairs $(i, j)$ with $f(i) = g(j)$ such that for each $i$,
\[
\sum_j t_{ij} = r_i
\]
and for each $j$
\[
\sum_i t_{ij} = r'_j .
\]
These cones have the universal property
\[
y U_{r_i} \times_f y U_{s_j} \cong \coprod_{t_{ij}} y U_{t_{ij}} .
\]
\end{lemma}
\begin{proof}
The $t_{ij}$ where precisely chosen such that the projections are measure preserving and such that they form the required commutative square. To show
\[
y U_{r_i} \times_f y U_{s_j} \cong \coprod_{t_{ij}} y U_{t_{ij}} ,
\]
send a pair of partitions $((a_i),(b_j))$ to the family $(a_i \wedge b_j)_{ij}$. The inverse of this map is given by joining the family with the universal maps described above.
\end{proof}


We could have presented the universal property in a more traditional style by saying that cones over our diagram factor through one of the $U_{t_{ij}}$.

We can use this lemma in order to simplify the following sheaf condition for sheaves over categories equipped with the atomic topology found in \cite{sheaves_geometry_logic}, III.4 Lemma 2:

A presheaf $\mathcal{F}$ on a $FinProb$ is a sheaf over the atomic topology if and only if one can check that for any morphism $f: \alpha \to \beta$ and any $a \in \mathcal{F}(\alpha)$: If for all diagrams

\[
\begin{tikzcd}
\gamma \arrow[r, "g", shift left] \arrow[r, "h"', shift right] & \alpha \arrow[r, "f"] & \beta
\end{tikzcd}
\]
with $f g = f h$ we have that $\mathcal{F}(g)(a) = \mathcal{F}(h)(a)$, then there is a unique lift $b \in \mathcal{F}(\beta)$ with the property that $\mathcal{F}(f)(b) = a$.

\begin{proposition} \label{sheaf_condition}
A presheaf $\mathcal{F}$ on $FinProb$ is a sheaf over the atomic topology if and only if for all maps of finite probability spaces $f: U_{r_i} \to U_{s_i}$, we have an equalizer diagram
\[
\begin{tikzcd}
\mathcal{F} U_{s_i} \arrow[r, "\mathcal{F}f"] & 
\mathcal{F} U_{r_i} \arrow[r, "\pi_1", shift left] \arrow[r, "\pi_2"', shift right] & \prod_{t_{ij}} \mathcal{F} U_{t_{ij}}
\end{tikzcd},
\]
where the $t_{ij}$ are as in \ref{multipullback} and the projection $\pi_1$ and $\pi_2$ are induced by the universal 'projection maps' defined in \ref{multipullback}.
\end{proposition}
\begin{proof}
Since for each $U_{t_{ij}}$ we have the commuting square
\[
\begin{tikzcd}
U_{t_{ij}} \arrow[r] \arrow[d] & {U_{r_i}} \arrow[d, "f"] \\
{U_{r_i}} \arrow[r, "f"']            & {U_{s_i}} ,
\end{tikzcd}
\]
$f$ certainly gives us a diagram
\[
\begin{tikzcd}
\mathcal{F} U_{s_i} \arrow[r, "\mathcal{F}f"] & \mathcal{F} U_{r_i} \arrow[r, "\pi_1", shift left] \arrow[r, "\pi_2"', shift right] & \prod_{t_{ij}} \mathcal{F} U_{t_{ij}}
\end{tikzcd}
\]
with $\pi_1 \mathcal{F}(f) = \pi_2 \mathcal{F}(f)$. Claiming that this is an equalizer means saying that for every $a \in \mathcal{F}U_{r_i}$ with the property that for all the projections $p_1: U_{t_{ij}} \to U_{r_i}$, $p_2: U_{t_{ij}} \to U_{r'_i}$ the equation $\mathcal{F}(p_1)(a) = \mathcal{F}(p_2)(a)$ is satisfied, implies that there is a unique lift $b \in \mathcal{F}U_{s_i}$ of $a$.

So our claim is that the criterion described above needs only be checked on the $U_{t_{ij}}$. Thus we assume that the equation above holds for the $U_{t_{ij}}$ with their projection maps. We need to show that the equation $\mathcal{F}(g)(a) = \mathcal{F}(h)(a)$ already holds for all the \[
\begin{tikzcd}
\gamma \arrow[r, "g", shift left] \arrow[r, "h"', shift right] & U_{r_i}
\end{tikzcd}
\]
with $fg = fh$. But this certainly holds, since we can factor $g$ and $h$ through one of the $U_{t_{ij}}$ by \ref{multipullback}.
\end{proof}

Note that this proposition actually had little to do with finite probability spaces and is really about a sheaf condition for atomic topologies where the base category has multipullbacks.

In some cases, one can prove the following condition that is much stronger than being a sheaf. It is especially useful when the sheaf doesn't really use the measure in its definition.

\begin{proposition} \label{sheaf_condition_weak}
Let $\mathcal{F}$ be a presheaf on $FinProb$. If for all morphisms $f: (X,\mu) \to (Y,\nu)$, we have an equalizer
\[
\begin{tikzcd} \mathcal{F} (Y,\nu) \arrow[r, "\mathcal{F}f"] & \mathcal{F} (X,\mu) \arrow[r, "\pi_1", shift left] \arrow[r, "\pi_2"', shift right] & \mathcal{F} (X \times_f X,\bar{\mu})
\end{tikzcd} ,
\]
where $\bar{\mu}$ is as in \ref{pullback_measure}, then $\mathcal{F}$ is a sheaf.
\end{proposition}
\begin{proof}
This is the condition from \cite{sheaves_geometry_logic} described above, but weakened by choosing $\gamma = (X \times_f X,\bar{\mu})$.
\end{proof}

\section{$\mathfrak{Prob}$ as a classifying topos}

In this section we will determine what $Sh(FinProb, J_{at})$ classifies. By default, we will use the notations and definitions as in part D.1 of \cite{elephant}. We warn the reader that this section contains big amounts of technical property-checking, so the uninterested reader can read the next definition and then skip to \ref{theory_of_intevals}. If the reader still wants an intuition about why \ref{classifying} should be true, we have provided an independent proof of a weaker theorem in the appendix. There prove our result only for the models of $Sh(FinProb, J_{at})$ in $Set$ in a way that should be accessible to a reader only familiar with $Ind$-completions and flat functors into $Set$. There we do not use any formal logic.

\begin{definition}
Define the geometric theory $\mathbb{T}_{bpalg}$ of boolean probability algebras to have one sort $B$, constants and function symbols
\begin{center}
$1: B$ \\
$0: B$ \\
$\wedge: B \times B \to B$ \\
$\vee: B \times B \to B$ \\
$\neg: B \to B$
\end{center}
and a unary relation symbol $B_r$ on $B$ for each $r \in [0,1]$. We impose the following axioms($a$, $b$ and $c$ denote free variables in $B$):
\begin{itemize}
\item \textit{Boolean algebra}.
\begin{align*}
\top &\vdash a \wedge (b \wedge c) = (a \wedge b) \wedge c && \text{associativity} \\
\top &\vdash a \vee (b \vee c) = (a \vee b) \vee c && \text{associativity} \\
\top &\vdash a \wedge 1 = a && \text{identity} \\
\top &\vdash a \vee 0 = a && \text{identity}\\
\top &\vdash a \wedge \neg{a} = 0 && \text{inverse}\\
\top &\vdash a \vee \neg{a} = 1 && \text{inverse}\\
\top &\vdash a \wedge (a \vee b) = a && \text{absorbtion}\\
\top &\vdash a \vee (a \wedge b) = a && \text{absorbtion}\\
\top &\vdash a \wedge (b \vee c) = (a \wedge b) \vee (a \wedge c) && \text{distributivity} \\
\top &\vdash a \vee (b \wedge c) = (a \vee b) \wedge (a \vee c) && \text{distributivity}
\end{align*}
\item \textit{$B_r$ form a partition}. For all $r, s \in [0,1]$ with $r \neq s$ we have an axiom
\[
B_r(a)  \wedge B_s(a) \vdash \bot
\]
and we also have an axiom
\[
\top \vdash \bigvee_{r \in [0,1]} B_r(a).
\]
\item \textit{Probability measure}. For all $r, s \in [0,1]$, we further require
\[
(a \wedge b = 0) \wedge B_r(a) \wedge B_s(a) \vdash B_{r+s}(a \vee b) 
\]
and finally we need
\begin{align*}
\top & \vdash B_1(1) \\
B_0(a) & \vdash a = 0.
\end{align*}
\end{itemize}
\end{definition}

Essentially, we have encoded a boolean probability algebra geometrically by partitioning the base sort $B$ into the elements $B_r$ of measure $r \in [0,1]$. If one were to write down the categorical interpretation of the two partition axioms, one would see that they are just saying that $B$ is a coproduct of the $B_r$.

Let us get some more notation out of the way.

\begin{definition}
Denote the category models of $\mathbb{T}_{bpalg}$ in $Set$ by $BPAlg$. Denote the category of finite models by $BPAlg_f$.
\end{definition}

The first thing to note is that this gives us an equivalent site for topos.

\begin{proposition} \label{finprob_equiv}
We have an equivalence of categories
\[
FinProb^{op} \simeq BPAlg_f
\]
defined by sending a finite probability space $(X, \mu)$ to the finite boolean probability algebra $(\mathcal{P} X, \bar{\mu})$, where
\[
\bar{\mu}(S) := \sum_{x \in S} \mu(x).
\]
A map in $FinProb$ is sent to the preimage map on powersets.
\end{proposition}
\begin{proof}
First we show a measure-preserving map $f: (X,\mu) \to (Y,\nu)$ in $FinProb$ is sent to a measure-preserving map $f^{-1}: (\mathcal{P}X, \bar{\mu}) \to (\mathcal{P}Y, \bar{\nu})$. So let $S \in \mathcal{P} Y$.
\begin{align*}
\bar{\mu}(f^{-1} S) &= \sum_{x \in f^{-1} S} \mu x \\
&= \sum_{y \in S} \sum_{x \in f^{-1} y} \mu x \\
&= \sum_{y \in S} \nu y \\
&= \bar{\nu} S
\end{align*}

The facts that this functor is full, faithful and essentially surjective on objects are instantly verified.
\end{proof}

We would like to show that the topos $Set^{FinProb^{op}}$ classifies $\mathbb{T}_{bpalg}$. Proving this fact requires a bit of work. The difficulty is mainly the fact that  $FinProb$ does not have all finite limits, so the flat functors on $FinProb$ are not as straightforward to understand. We will prove the equivalence
\[
Set[\mathbb{T}_{bpalg}] \simeq Set^{FinProb^{op}}
\]
by purely syntactical means. The functor in one direction will be given by an appropriate model of $\mathbb{T}_{bpalg}$ in $Set^{FinProb^{op}}$. The challenge lies in proving that this gives an equivalence. We will show this by interpreting the topos on the left hand side as the classifying topos of the theory of flat functors on $FinProb$ and using this fact we will give an inverse functor. Working purely syntactically is essential to being able to comfortably write down a formal argument. That means that we will need to extensively work with geometric logic.

To get an idea of what the universal model might be, one can for example look at the universal models in classifying toposes of cartesian theories $\mathbb{T}$. In those cases the universal model in $[\mathbb{T} \text{-} Mod(Set)_{f.p.}, Set]$ just corresponds to the forgetful functor sending a (finitely presented) $\mathbb{T}$-model to its underlying set. Of course, the forgetful functor comes equipped with the required $\mathbb{T}$-model structure. For more details, see D3.1.2 of \cite{elephant}.

The above gives us some inspiration as to how to guess the universal model. We want it to be the functor in $Set^{BPAlg_f}$ that gives us the underlying set of the boolean algebra in question. On the equivalent topos $Set^{FinProb^{op}}$, this happens to be the powerset functor on the underlying set of the finite probability space in question. We can give an alternative description. First, we introduce the shorthand $U_r := U_{r,r-1}$ for $r \in (0,1)$. We will think of the functor $y U_r$ as the functor sending a finite probability space to the set of subsets of measure $r$. Similarly, we will think of the functor $y U_{r_i}$ as the functor sending a finite probability space $(X,\mu)$ to the set its partitions $(a_i)$ with $\mu(a_i) = r_i$. Then we can define $U$ to be
\[
\coprod_{r \in [0,1]} y U_r \in Set^{FinProb^{op}} .
\]
One immediately sees that $U$ is just the powerset functor on the underlying set of a given probability space. This means that map $f$ between probability spaces gets sent to the map that takes the preimage of a subset. We will see that the $U_r$ can be interpreted as the unary relations of the theory $\mathbb{T}_{bpalg}$.

\begin{lemma} \label{universal model}
$U$ is a model of the $\mathbb{T}_{bpalg}$. The sort $B$ is given by $U$. The relation symbols $B_r$ are given by $U_r$ and the boolean algebra operations given by the fact that at every $(X,\mu) \in FinProb$, $U(X, \mu)$ is the powerset of $X$. This yields a left-exact, colimit-preserving functor $Set^{FinProb^{op}} \leftarrow Set[\mathbb{T}_{bpalg}]$.
\end{lemma}
\begin{proof}
We begin with some well-definedness remarks. Notice that under the equivalence $Set^{FinProb^{op}} \simeq Set^{BPAlg_f}$, $U$ becomes the functor forgetting the boolean algebra structure. The operations $\wedge, \vee \text{ and } \neg$ on $U$ can now be defined as the regular boolean algebra operations at every object of $BPAlg_f$. Since the boolean algebra homomorphisms in $BPAlg_f$ preserve $\wedge, \vee \text{ and } \neg$, we get naturality of the operations. Similarly, the inclusions $y U_r \to U$ are natural by the fact that boolean probability algebra morphisms preserve measure.

Since we are looking at presheaves, all the colimit and limit conditions from the axioms can be checked pointwise, where they are trivial. More formally, we can use \cite{elephant}, Corollary D.1.2.14, to get the fact that $U$ is a $\mathbb{T}_{bpalg}$-model in $Set^{BPAlg_f}$.
\end{proof}

Before we can give the inverse functor, we need a lemma that tells us how to internalize formulas over a signature $\Sigma$ into a $\Sigma$-structure inside a syntactic category $\mathcal{C}^{\mathbb{T}}$ of a geometric theory $\mathbb{T}$. Essentially, this reformulates the abstract definition(in terms of syntactic categories) of what an \textit{interpretation} of a theory into another theory is concretely in terms of actual formulas. This will be used for defining an interpretation of the theory of flat functors over $FinProb$ into $\mathbb{T}_{bpalg}$, which will happen to yield the inverse functor in the equivalence of categories we are trying to prove. The proof of this lemma mostly consists of computing some categorical constructions inside $\mathcal{C}^{\mathbb{T}}$(which are described in D.1.4 of \cite{elephant}), so the it can safely be skipped.

We diverge from the notation in D.1 of \cite{elephant} in that we will sometimes annotate a formulas with a set of variables containing all the variables used in the formula, as seen below. This is done so that when these formulas get combined with logical connectives, the big formula remains easy to read.

Since the theory of flat functors we will apply this lemma to has no relation symbols, we restrict ourselves to the case where $\Sigma$ has no relation symbols

\begin{lemma} [Computing interpretations] \label{interpretations}
Let $\mathbb{T}$ be a geometric theory and $\mathcal{C}^{\mathbb{T}}$ its syntactic category. Let $\Sigma$ be a signature without relation symbols and $M$ be a $\Sigma$-structure in $\mathcal{C}^{\mathbb{T}}$.
\begin{itemize}
\item Let $A$ be a sort in $\Sigma$ and $M(A) = \{\vec{a} . \phi_A^{\vec{a}}\}$. Then we have
\begin{enumerate}
\item
\[
M([]) \cong \{[] . \top\}
\]
\item and for sorts $A_1, \cdots, A_n$ in $\Sigma$
\[
M(A_1, \cdots, A_n) \cong \{\vec{a} . \phi_{A_1}^{\vec{a_1}} \wedge \cdots \wedge \phi_{A_n}^{\vec{a_n}}\} .
\]
\end{enumerate}
\item $M$ assigns to each term in context $\{\vec{x} . t\}$ a $\mathbb{T}$-provable functional
\[
[\theta_t^{\vec{a}, \vec{b}}]: \big \{ \vec{a} . \bigwedge_i \phi_{A_i}^{\vec{a_i}} \big \} \to \{\vec{b} . \phi_B^{\vec{b}}\} .
\]
We have the following recursive computation formulas:
\begin{enumerate}
\item Let $f: A_1 \times \cdots \times A_n \to B$ be a function symbol in $\Sigma$.  For variables $x_1 :A_1, \cdots, x_n: A_n$, we have
\[
\ldoub \vec{x} . f\rdoub_M = [\theta_f^{\vec{a}, b}] , 
\]
which is given by $M(f)$.
\item $\ldoub\vec{x} . x_i \rdoub_M: \big \{ \vec{a} . \bigwedge_i \phi_{A_i}^{\vec{a_i}} \big \} \to \{\vec{a'} . \phi_B^{\vec{a'}}\}$ can be computed by
\[
\ldoub\vec{x} . x_i \rdoub_M = \big [ \bigwedge_i \phi_{A_i}^{\vec{a_i}} \wedge (\vec{a_i} = \vec{a'})\big ] .
\]
\item Let $f$ be a function symbol in $\Sigma$. Then
\[
\ldoub \vec{x} . f(t_1, \cdots, t_n) \rdoub_M = [(\exists b) \theta_{t_1}^{\vec{a}, \vec{b}} \wedge \cdots \wedge \theta_{t_1}^{\vec{a}, \vec{b}} \wedge \theta_f^{\vec{b}, \vec{c}}],
\]
where $\vec{a}$ are the variables in the domain of the morphism and $\vec{b}$ the variables in the codomain.
\end{enumerate}
\item $M$ assigns to each formula in context $\{\vec{x} . \varphi \}$ a subobject
\[
\{\vec{a} . \chi_{\varphi}^{\vec{a}} \} \xhookrightarrow{} \{ \vec{a'} . \bigwedge_i \phi_{A_i}^{\vec{a'_i}}\} .
\]
We will not give formulas for the inclusion arrow, as its form is already uniquely determined by $\chi_{\varphi}^{\vec{a}}$ (D.1.4.4 (iv) in \cite{elephant}). We have the following recursive computation formulas:
\begin{enumerate}
\item For terms in context $\{\vec{x} . s\}$ and $\{\vec{x} . t\}$, we have
\[
\ldoub\vec{x} . s = t \rdoub_M \cong \{\vec{a} . (\exists \vec{b}) (\theta_s^{\vec{a}, \vec{b}} \wedge \theta_t^{\vec{a}, \vec{b}}) \}
\]
\item For formulas in context $\{\vec{x} . \psi_i\}$ we have
\[
\ldoub\vec{x} . \bigvee_i \psi_i \rdoub_M \cong \big \{ \vec{a} . \bigvee_i \chi_{\psi_i}^{\vec{a}} \big \} . 
\]
\item For finitely many formulas in context $\{\vec{x} . \psi_i\}$ we have
\[
\ldoub\vec{x} . \bigwedge_i \psi_i \rdoub_M \cong \big \{ \vec{a} . \bigwedge_i \chi_{\psi_i}^{\vec{a}} \big \} . 
\]
\item Let $\{\vec{x}, y . \psi \}$ be a formula in context. Then
\[
\ldoub\vec{x} . (\exists y) \psi\rdoub_M \cong \{\vec{a} . (\exists \vec{b}) \chi^{\vec{a}, \vec{b}}_{\psi} \} .
\]
\end{enumerate}
\end{itemize}

\end{lemma}
\begin{proof}
D.1.4.2 in \cite{elephant} describes how to compute limits in $\mathcal{C}^{\mathbb{T}}$ \footnote{Technically this is only shown for cartesian syntactic categories, but at the bottom of page 847 there is a note about this also working for geometric syntactic categories of geometric theories.}. This immediately gives the first part about the sorts.

Now in the part about the terms, in (i) there is nothing to show. In (ii), we again just use the description of finite limits in D.1.4.2. (iii) is can be proved by writing down the internalized arrow, computing a map induced by the universal property of the cartesian product and computing composition in $\mathcal{C}^{\mathbb{T}}$.

In the part about formulas, (i) is again just the computation of an equalizer in $\mathcal{C}^{\mathbb{T}}$. For (ii) and (iii) notice that D.1.4.4 (iv) in \cite{elephant} tells us that the subobject lattice of $\{ \vec{a} . \bigwedge_i \phi_{A_i}^{\vec{a_i}}\}$ is equivalent(as a category that happen to be a preorder) to the formulas $\psi$ over the context $\vec{a}$ such that $\psi \vdash_{\vec{a}} \bigwedge_i \phi_{A_i}^{\vec{a_i}}$ equipped with the poset structure given by $\vdash_{\vec{a}}$. This means that we can compute the logical operations $\bigwedge$ and $\bigvee$ on formulas over $\Sigma$ by using the joins and meets in poset of formulas over $\mathbb{T}$, which are precisely the logical operations $\bigwedge$ and $\bigvee$ on the formulas over $\mathbb{T}$(this is what the rules for conjunction and disjunction say).

For (iv), letting $\pi$ denote the projection onto the components given by the $A_i$, we compute:
\begin{align*}
\ldoub \vec{x} . (\exists y) \psi \rdoub_M
&\cong Im \Big (\{ \vec{a'}, \vec{b'} . \chi_{\psi}^{\vec{a'}, \vec{b'}}\} \xhookrightarrow{} \{\vec{a''}, \vec{b''} . \bigwedge_i \phi_{A_i}^{\vec{a_i''}} \wedge \phi_B^{\vec{b''}} \} \xrightarrow{\pi} \{\vec{a} . \bigwedge_i \phi_{A_i}^{\vec{a_i}}\} \Big ) \\
\shortintertext{Expand the codomain to $\{\vec{a} . \top \}$:}
&\cong Im \Big (\{ \vec{a'}, \vec{b'} . \chi_{\psi}^{\vec{a'}, \vec{b'}}\} \xhookrightarrow{[\chi_{\psi}^{\vec{a'}, \vec{b'}} \wedge (a = a')]} \{ \vec{a} . \top \} \Big ) \\
\shortintertext{Calculate this as in the proof of D.1.4.10 i) in \cite{elephant}:}
&\cong \{\vec{a} . (\exists \vec{a'}, \vec{b'}) \chi_{\psi}^{\vec{a'}, \vec{b'}} \wedge (\vec{a} = \vec{a'}) \} \\
&\cong \{\vec{a} . (\exists \vec{b}) \chi_{\psi}^{\vec{a}, \vec{b}}\}
\end{align*}

\end{proof}

The following two facts allow us to interpret statements $t = s$ into an easier form without noise given by redundant variables.

\begin{lemma} With the same setup as in \ref{interpretations}, we have that for a function symbol $f$ in $\Sigma$,
\[
\ldoub \vec{x} . f(\vec{x}) \rdoub_M \cong [ \theta_f^{\vec{a}, \vec{b}} ]
\]
and for a term $t$ with free variables among the $\vec{x}$,
\[
\ldoub \vec{x} . (t=x_i) \rdoub_M \cong \{\vec{a} . \theta_f^{\vec{a},a_i} \} .
\]
\end{lemma}

\begin{proof}
Boring.
\end{proof}

We now define the inverse functor. We induce it by a geometric functor $\mathcal{C}^{\mathbb{T}^{FinProb}} \to \mathcal{C}^{\mathbb{T}}$, where $\mathbb{T}^{FinProb}$ denotes the theory of flat functors over $FinProb$. Such a geometric functor of course is given by a model of $\mathbb{T}^{FinProb}$ in $\mathcal{C}^{\mathbb{T}_{bpalg}}$. We give the functor in this way because it allows us to use internal logic to prove that the induced functor on classifying toposes is left-exact, which will be needed when showing that the functors are inverses of each other.

We will identify the objects and arrows in $FinProb$ with the corresponding sorts and function symbols in $\mathbb{T}^{FinProb}$.

\begin{lemma} \label{inverse}
We have a $\mathbb{T}^{FinProb}$-model in $\mathcal{C}^{\mathbb{T}_{bpalg}}$ given as follows. Let $f: (X,\mu) \to (Y, \nu)$ be an arrow in $FinProb$. We specify a model $F$ on the sort given by $(X,\mu)$ and on the function symbol given by $f$ by:
\begin{align*}
\{\vec{a} . \phi_{X,\mu}^{\vec{a}}\} &:= \Bigg \{ \vec{a} . \bigwedge_{i \in X} B_{\mu(i)} a_i \wedge \bigwedge_{\substack{i,j \in X \\ i \neq j}} (a_i \wedge a_j = 0) \Bigg \} \\
[\theta_f^{\vec{a}, \vec{b}}] &:= \Bigg [ \bigwedge_{j \in Y} (b_j = \bigvee_{f i = j} a_i) \wedge \phi_{X,\mu}^{\vec{a}} \Bigg] ,
\end{align*}
so now we can give $F((X,\mu))$ by $\{\vec{a} . \phi_{X,\mu}^{\vec{a}}\}$ and $F(f)$ by $[\theta_f^{\vec{a}, \vec{b}}]$.
\end{lemma}

The model $M$ has a straightforward intuitive meaning: The sorts can be interpreted as partitions of a boolean algebra into elements of prescribed measure. The function symbols compute unions of the partitions in prescribed ways.

\begin{proof}
First notice that $[\theta_f^{\vec{a}, \vec{b}}]$ has actually the correct codomain by additivity of the measure. It is also easily seen to be provably functional.

The challenge is showing that this is actually a model of the theory of flat functors on $FinProb$.  Now we check that the five axioms of the theory $\mathbb{T}^{FinProb}$ are satisfied in the above interpretation. We will heavily and implicitly make use of the previous two lemmas.
\begin{enumerate}
\item The sequent
\[
\top \vdash_x id(x) = x
\]
interprets to the sequent
\[
\top \vdash_a \theta_{id}^{a,a} ,
\]
which holds since $\theta_{id}^{a,a} \dashv \vdash_a a = a \dashv \vdash_a \top$.

\item Let $h = g f$ be the composition of two arrows in $FinProb$. The sequent
\[
\top \vdash_x h(x) = g(f(x))
\]
interprets to the sequent
\[
\top \vdash_a (\exists b, c) \theta^{a,b}_h \wedge \theta^{a,c}_f \wedge \theta^{c,b}_g ,
\]
which can be checked with associativity and commutativity of the $\vee$ operation and with the additivity of the the measure.

\item The sequent
\[
\top \vdash_{[]} \bigvee_{\alpha \in FinProb} (\exists x^{\alpha}) \top ,
\]
where $x^{\alpha}$ denotes a variable of sort $\alpha$, interprets to the sequent
\[
\top \vdash_{[]} \bigvee_{\alpha \in FinProb} (\exists a) \phi_{\alpha}^a .
\]
But of course we have
\[
\top \vdash_{[]} B_1(1) \vdash_{[]} \phi^1_{U_1} ,
\]
which means that this axiom holds.

\item Let $\alpha$, $\beta$ be finite probability spaces and $x$, $y$ be variables of these sorts, respectively, and moreover let $z^{\gamma}$ be of sort $\gamma$, for any finite probability space $\gamma$. The sequent
\[
\top \vdash_{x,y} \bigvee_{\alpha \xleftarrow{f} \gamma \xrightarrow{g} \beta} (\exists z^{\gamma}) (f(z^{\gamma}) = x) \wedge (g(z^{\gamma}) = y) ,
\]
where the disjunction goes over all cones of the specified shape, interprets to the sequent
\[
\phi^{\vec{a}}_{\alpha} \wedge \phi^{\vec{b}}_{\beta} \vdash_{\vec{a}, \vec{b}} \bigvee_{\alpha \xleftarrow{f} \gamma \xrightarrow{g} \beta} (\exists \vec{c})(\theta_f^{\vec{c},\vec{a}} \wedge \theta_g^{\vec{c},\vec{b}}) .
\]

Now, by the partition axiom, we have that $\top \vdash \bigvee_{r_{ij} \in [0,1]} \phi_{U_{r_{ij}}}^{\vec{a}\wedge\vec{b}}$, where $i$ ranges over the elements of $\alpha$ and $j$ ranges over the elements of $\beta$ and moreover, $\vec{a}\wedge\vec{b}$ denotes all the variables that arise from terms of the form $a_i \wedge b_j$. We can use this fact in order to rewrite the left hand side as

\[
\bigvee_{r_{ij} \in [0,1]} \phi^{\vec{a}}_{\alpha} \wedge \phi^{\vec{b}}_{\beta} \wedge \phi_{U_{r_{ij}}}^{\vec{a}\wedge\vec{b}} .
\]

Thus we can show the sequent above, by instead showing that for all families of $r_{ij} \in [0,1]$, the following holds:

\[
\phi^{\vec{a}}_{\alpha} \wedge \phi^{\vec{b}}_{\beta} \wedge \phi_{U_{r_{ij}}}^{\vec{a}\wedge\vec{b}} \vdash_{\vec{a},\vec{b}} (\exists \vec{c})(\theta_f^{\vec{c},\vec{a}} \wedge \theta_g^{\vec{c},\vec{b}}) ,
\]
where $c$ is of the sort $U_{r_{ij}}$ and $f$ and $g$ are the canonical maps projecting onto the correct indices. But this last sequent is easily seen to hold by setting $c_{ij} := a_i \wedge b_j$.

\item Let
\begin{tikzcd}
\alpha \arrow[r, "f", shift left] \arrow[r, "g"', shift right] & \beta
\end{tikzcd}
be a diagram in $FinProb$ and let $x$ be a variable of sort $\alpha$ and $z^{\gamma}$ of sort $\gamma$ for any $\gamma$. The sequent
\[
f(x) = g(x) \vdash_x \bigvee_{\substack{\gamma \xrightarrow{h} \alpha \\ fh = gh}} (\exists z)(h(z) = x)
\]
interprets to the sequent
\[
(\exists \vec{b}) \theta_f^{\vec{a},\vec{b}} \wedge \theta_g^{\vec{a},\vec{b}} \vdash_{\vec{a}} \bigvee_{\substack{\gamma \xrightarrow{h} \alpha \\ fh = gh}} (\exists c) \theta_h^{c,a} .
\]
In the case that $f=g$, this sequent is trivial, since we can set $h = id$. In the case that $f \neq g$, let $k$ be such that $f(k) \neq g(k)$. Now we can also prove the sequent by deriving $\bot$.
\begin{align*}
(\exists \vec{b}) \theta_f^{\vec{a},\vec{b}} \wedge \theta_g^{\vec{a},\vec{b}}
&\vdash_{\vec{a}} (\exists \vec{b}) \bigwedge_{j \in \beta} (b_j = \bigvee_{f i = j} a_i) \wedge \bigwedge_{j \in \beta} (b_j = \bigvee_{g i = j} a_i) \wedge \phi_{\alpha}^{\vec{a}} \\
&\vdash_{\vec{a}} \bigwedge_{j \in \beta} \big ( \bigvee_{f i = j} a_i = \bigvee_{g i = j} a_i \big ) \wedge \phi_{\alpha}^{\vec{a}} \\
&\vdash_{\vec{a}} \big ( \bigvee_{f i = f k} a_i = \bigvee_{g i = f k} a_i \big ) \wedge \phi_{\alpha}^{\vec{a}} \\
&\vdash_{\vec{a}} \big ( \bigvee_{f i = f k} a_i \wedge a_k = \bigvee_{g i = f k} a_i \wedge a_k \big ) \wedge \phi_{\alpha}^{\vec{a}}\\
&\vdash_{\vec{a}} (a_k = 0) \wedge \phi_{\alpha}^{\vec{a}} \\
&\vdash_{\vec{a}} \bot
\end{align*}
\end{enumerate}
\end{proof}

Finally, we show that the above functors assemble into an equivalence of categories. We abuse notation and identify the candidate universal model $U$ with the corresponding functor $\mathcal{C}^{\mathbb{T}} \to Set^{FinProb^{op}}$. $U$, of course, induces a left-exact, colimit-preserving functor
\[
Set^{FinProb^{op}} \leftarrow Set[\mathbb{T}]: Lan_y(U).
\]

Similarly, we abuse notation and identify $F$, our $\mathbb{T}^{FinProb}$-model in $\mathcal{C}^{\mathbb{T}_{bpalg}}$ with a flat functor $FinProb \to \mathcal{C}^{\mathbb{T}_{bpalg}}$, that of course induces a left-exact, colimit-preserving functor
\[
Lan_F: Set^{FinProb^{op}} \to Set[\mathbb{T}].
\]

\begin{theorem}[Classifying topos of $\mathbb{T}_{bpalg}$] \label{classifying_presheaf}
$Lan_y(U)$ and $Lan_F$ define an equivalence of categories
\[
Set^{FinProb^{op}} \simeq Set[\mathbb{T}_{bpalg}].
\]
\end{theorem}
\begin{proof}
For this proof, let $\mathbb{T} := \mathbb{T}_{bpalg}$.

We check that the functors we defined are inverses to each other.

We first check that $Lan_y(U) \circ Lan_F \cong Id$. Since these functors preserve colimits, we check only need to check this on representables. So let $(X,\mu) \in FinProb$. Then we get natural isomorphisms

\begin{align*}
Lan_y(U)(Lan_F(y(X,\mu))) &\cong Lan_y(U)(yF(X,\mu)) \\
&\cong UF(X,\mu) \\
&\cong U \{\vec{a} . \phi^{\vec{a}}_{X,\mu}\} \\
&\cong \ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U .
\end{align*}

It remains to show that we have a natural isomorphim $y (X,\mu) \to \ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U$. First, we compute this functor on objects. Since the corresponding limits are computed pointwise, we first get a natural (in $(X,\mu)$) isomorphism
\[
\ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U (Y,\nu) \cong \ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_{U(Y,\nu)} .
\]
But computing these pullbacks and equalizers in $Set$ yields
\begin{align*}
\ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_{U(Y,\nu)} \cong
\{\{V_x\} \subset Y | (\nu(V_x) = \mu(x)) \wedge (V_x \cap V_y = \emptyset) \text{ for } x,y \in X, x \neq y\} .
\end{align*}

Now we can use this together with the Yoneda lemma in order to give the required isomorphism $y (X,\nu) \to \ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U$ by the element $\{x\}_{x \in X} \in \ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_{U(X,\mu)}$. In order to show this actually is an isomorphism, we explicitly compute this isomorphism on an $f \in y (X,\mu) (Y,\nu)$. In order to do that, we note that the functor $\ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U$ is a subfunctor of $\prod_{x \in X} U$, so that lets us see that the map
\[
\ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U(X,\mu) \to \ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U(Y,\nu)
\]
sends $\{x\}_{x \in X}$ to $\{f^{-1} x\}_{x \in X}$. This means that the morphism
\[
y (X,\mu) (Y,\nu) \to \ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U(Y,\nu)
\]
sends an $f$ to the family $\{f^{-1} x\}$. This clearly is an isomorphism, so $y (X,\nu) \to \ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_U$ is an isomorphism.

We still need to show this isomorphism is natural in $(X,\mu)$. We prove naturality on each $(Y,\nu) \in FinProb$. So let $(X,\mu), (X',\mu') \in FinProb$. The diagram
\[
\begin{tikzcd}
    {Hom((Y,\nu),(X,\mu))} \arrow[r, "\cong"] \arrow[d, "f_*"'] & {\ldoub \vec{a} . \phi^{\vec{a}}_{X,\mu} \rdoub_{U(Y,\nu)}} \arrow[d, "{\ldoub \vec{a},\vec{b} . \theta_f \rdoub}"] \\
    {Hom((Y,\nu),(X',\mu'))} \arrow[r, "\cong"]                 & {\ldoub \vec{a} . \phi^{\vec{a}}_{X',\mu'} \rdoub_{U(Y,\nu)}}                                             
\end{tikzcd}
\]
commutes because this is the way $\{\vec{a},\vec{b} . \theta_f \}$ internalizes in a $Set$-model. This concludes our proof of $Lan_y(U) \circ Lan_F \cong Id$.

We now prove that $Lan_F \circ Lan_y(U) = Id$. Since all the functors involved are left-exact and colimit-preserving, it suffices to show that the isomorphism holds on the corresponding models of $\mathbb{T}$ inside $Set[\mathbb{T}]$. This means we have to compute $Lan_F \circ Lan_y(U)$ on the 'signature' of $\mathbb{T}$ and show that the yielded structure is isomorphic as a $\mathbb{T}$-model to the universal model of $Set[\mathbb{T}]$.

We first check this for the sort $B$. This means that we have to show that $Lan_F(U) \cong y \{b . \top\}$. This reduces to showing
\[
\coprod_{r \in [0,1]} y \{b . B_r b\} \cong y \{b . \top\} .
\]
We can prove this by showing that for every sheaf $\mathcal{F} \in Set[\mathbb{T}]$, we have a natural bijection
\[
Hom(y \{b . \top\}, \mathcal{F}) \cong \prod_{r \in [0,1]} Hom(y \{b . B_r b\}, \mathcal{F})
\]
given by the inclusions $\iota_r : \{b . B_r b\} \to \{b . \top\}$. Applying the yoneda lemma on both sides, this is equivalent to showing that the inclusions induce an isomorphism
\[
\mathcal{F} \{b . \top\} \cong \prod_{r \in [0,1]} \mathcal{F} \{b . B_r b\} .
\]
But this can be checked by applying the sheaf condition to the cover of $\{b . \top\}$ given by the $\{b . B_r b\}$. Notice that here we are using the two partition axioms.

Next, we need to show that the above isomorphism actually is an isomorphism of $\mathbb{T}$-models. Explicitly, we have to show that for each function symbol $f$ our isomorphism induces an iso
\[
\begin{tikzcd}[column sep=tiny]
    {y \{a_1,\cdots,a_n . \top \}} \arrow[d, "{[f(a_1,\cdots,a_n) = a]}"'] \arrow[r, "\cong"',phantom, shift right=7] & Lan_F U^n \arrow[d, "Lan_F U(f)"] \\
    y \{a . \top \}                                                                                           & Lan_F U                            
\end{tikzcd}
\]
in the category of arrows in $Set[\mathbb{T}]$. The upper isomorphim is induced by the data of the respective universal cones exhibiting the upper objects as cartesian products. We also need the analogous statement for relation symbols. In particular this apply this remark to Kan-extensions. Notice that here and also in what follows, we are taken the viewpoint on objects defined by universal property described in section \ref{conventions}. 

We first consider the 0-ary function $U(0): * \to U$. We get the chain of isomorphisms

\[
\begin{tikzcd}
Lan_F * \arrow[d, "Lan_F U(0)"'] \arrow[r, "\cong"',phantom, shift right=7] & Lan_F y U_0 \arrow[d] \arrow[r, "\cong"',phantom, shift right=7] & y \{b . B_0 b \} \arrow[d] \arrow[r, "\cong"',phantom, shift right=7] & {y \{[].\top\}} \arrow[d, "{[a=0]_*}"] \\
Lan_F U                                                             & Lan_F \coprod y U_r                                      & \coprod y \{ b . B_r b\}                                      & y\{a.\top\}                         
\end{tikzcd}
\]

where the first three isos clearly are isos satisfying the commutativity condition. The only interesting step in this chain is where we use the fact that $\{b . B_0 b\} \cong \{a . a = 0\} \cong \{[]. \top\}$, where the first isomorphism uses the that $B_0 a \dashv \vdash_a (a = 0)$. One can check that the last commutativity condition also holds:
\[
[B_0 b]_* [a=0]_* = [B_0 b \wedge (a = 0)]_* = [B_0 b \wedge (a=b)]_*,
\]
where the left hand side is the upper right composition and the right hand side is the lower left composition. Now the composite isomorphism on the bottom clearly is the one constructed earlier. The proof for $1$ is almost the same, again one only needs the fact that $B_1 a \dashv \vdash_a (a = 1)$, which is provable in our theory.

We proceed with the binary function $U(\wedge): U \times U \to U$. We will prove the required isomorphism in the following two steps:
\[
\begin{tikzcd}
Lan_F(U \times U) \arrow[d, "Lan_F(U(\wedge))"'] \arrow[r, phantom, shift right=7, "\cong"] & {\coprod y \{\vec{b}.\bigwedge_{i=1,\cdots 4} B_{r_i} b_i\}} \arrow[d] \arrow[r, phantom, shift right=7, "\cong"] & {y \{a_1,a_2.\top\}} \arrow[d, "{[a = a_1 \wedge a_2]_*}"] \\
Lan_F U                                          & \coprod y \{b.B_rb\} & y\{a.\top\} .
\end{tikzcd}
\]
We start with the left isomorphism. We can use \ref{multipullback} to rewrite $U \times U$ as a coproduct of representables by using the isomorphism $U \times U \to \coprod y U_{r_1 \cdots r_4}$ given on components by 
\[
(a,b) \mapsto (a \wedge b, a \wedge \neg b, \neg a \wedge b, \neg a \wedge \neg b) .
\]
Using the inverse of this isomorphism $(b_1,b_2,b_3,b_4) \mapsto (b_1 \vee b_2, b_1 \vee b_3)$, we get the commutative square which after applying $Lan_F$ yields the required commutative square above on the left
\[
\begin{tikzcd}
U \times U \arrow[d, "U(\wedge)"'] & \coprod y U_{r_1 \cdots r_4} \arrow[d, "\coprod f"] \arrow[l, "\cong"'] \\
U                                  & \coprod y U_r \arrow[l, "\cong"]                          ,
\end{tikzcd}
\]

where $f$ sends a partition into four subsets onto the first subset. Since we do not only need any isomorphism $Lan_F (U \times U) \cong \coprod y F (U_{r_1 \cdots r_4})$, but a specific one induced on the components on the cartesian product, we check that the upper isomorphism in our diagram is in fact induced by the required isomorphism. We do this by noting that the map $U \times U \xleftarrow{\cong} \coprod y U_{r_1 \cdots r_4}$ commutes with the required map on the first projection of the cartesian products:

\[
\begin{tikzcd}
U \times U \arrow[d, "p_1"'] & \coprod y U_{r_1 \cdots r_4} \arrow[d, "\alpha_1"] \arrow[l, "\cong"'] \\
U                            & \coprod y U_r \arrow[l, "\cong"]                                    ,
\end{tikzcd}
\]
where $\alpha_1$ is the map induced by the maps $y U_{r_1 \cdots r_4} \to y U_r$ given by $(b_1,\cdots,b_4) \mapsto b_1 \vee b_2$, where the $b_i$ are seen as partitions. There is an analogous map $\alpha_2$ that has a similar relation to the second projection $p_2$. Now the two isomorphims on the the diagram above imply that $\alpha_1$ and $\alpha_2$ form a universal cone for a cartesian product. This immediately implies that the isomorphism $U \times U \cong \coprod y U_{r_1 \cdots r_4}$ is the one induced by the universal properties of the product and moreover, by flatness of $F$, this fact gets preserved when applying $Lan_F$. Now that we have shown the first part of the isomorphism, we wish to show that we have an isomorphism
\[
\begin{tikzcd}
{\coprod y \{\vec{b}.\bigwedge_{i=1,\cdots 4} B_{r_i} b_i\}} \arrow[d, "{\coprod [b = b_1]_*}"'] \arrow[r, "\phi"] & {y \{a_1,a_2.\top\}} \arrow[d, "{[a = a_1 \wedge a_2]_*}"] \\
\coprod y \{b.B_rb\} \arrow[r, "\cong"']                                                & y\{a.\top\}                                               ,
\end{tikzcd}
\]
where $\phi$ is given by $[(a_1 = b_1 \vee b_2) \wedge (a_2 = b_1 \vee b_3)]_*$. It is easy to see that the diagram commutes. The fact that $\phi$ is an isomorphism will follow by the fact that $\phi$ is induced by the required isomorphisms. Like earlier, this is shown by remarking that

\[
\begin{tikzcd}
{\coprod y \{\vec{b}.\bigwedge_{i=1,\cdots 4} B_{r_i} b_i\}} \arrow[d, "\alpha_1"'] \arrow[r, "\phi"] & {y \{a_1,a_2.\top\}} \arrow[d, "{[a = a_1]_*}"] \\
\coprod y \{b.B_rb\} \arrow[r, "\cong"']                                                            & y\{a.\top\}
\end{tikzcd}
\]
commutes. But this time, we already know that $\alpha_1$ and $\alpha_2$ are a universal cone of a product and similarly, $[a=a_1]_*$ and $[a=a_2]_*$ are the projections of a product. This already implies that $\phi$ is induced by the correct isomorphisms and moreover that $\phi$ itself is an isomorphism. This concludes the proof that $Lan_F U(\wedge)$ matches the corresponding operation on the universal model in $Set[\mathbb{T}]$. The argument for $\vee$ should be very similar.

We show that $Lan_F U(\neg)$ matches the corresponding operation on the universal model, by showing that we don't need to show it. Let $\mathbb{T}_{BAlg}$ denote the theory of boolean algebras and $\mathbb{T}_{DLat'}$ be the theory of distributive lattices together with the axiom
\[
\top \vdash_{x} (\exists y) ((x \wedge y=0)\wedge (x\vee y=1)) .
\]

We even have that $\mathcal{C}^{\mathbb{T}_{BAlg}} \simeq \mathcal{C}^{\mathbb{T}_{DLat'}}$. The functor pointing towards the left is just given by the universal model in $\mathbb{T}_{BAlg}$. The functor pointing towards the right is given by the universal model in $\mathbb{T}_{DLat'}$, where negation is given by the $\mathbb{T}_{DLat'}$-provably functional formula
\[
[(x\wedge y=0) \wedge (x\vee y=1)] : \{x.\top\} \to \{y.\top\}  .
\]

One can verify that this actually is an equivalence by using \ref{interpretations} and the fact that
\[
[y=\neg x] = [(x\wedge y=0) \wedge (x\vee y=1)] 
\]
in $\mathcal{C}^{\mathbb{T}_{BAlg}}$. This now proves that we don't need to check that negation gets preserved, by identifying models of $\mathbb{T}_{BAlg}$ with models of $\mathbb{T}_{DLat'}$.

Luckily, sending $U_r \to \coprod U_r$ through $Lan_F$ is easily seen to give the expected subobject, concluding the proof.
\end{proof}

We proceed by investigating what $Sh(FinProb, J_{at})$ classifies.

\begin{definition} \label{theory_of_intevals}
Define the \textit{theory of intervals} $\mathbb{T}_{int}$ by adding the axioms
\[
B_s a \vdash_a (\exists b) \big ( (b = a \wedge b) \wedge B_r b \big )
\]
for all $r,s \in [0,1]$ with $r \leq s$ to the theory of boolean probability algebras.
\end{definition}

Note that the models of $\mathbb{T}_{int}$ in $Set$ must all be uncountable. We now look at some examples of intervals in $Set$.

\begin{definition}
Call a boolean probability algebra $(A,\mu)$ simply a probability algebra, if $A$ is a complete boolean algebra and moreover, for every directed family $a_i$ of elements of $A$, we have the additivity condition
\[
\mu(\bigvee a_i) = \text{sup } \mu(a_i) .
\]
The pairs $(A,\mu)$ for which there is a $c > 0$ such that $(A, c \mu)$ is a probability algebra will simply be called measure algebras. A morphism of measure algebras is a morphism of boolean algebras that is measure-preserving.
\end{definition}

Note that we have chosen a slightly more restrictive definition of measure algebra than is standard, since we did not allow the measure to adopt infinite values.

Measure algebras are the correct setting for doing measure theory while ignoring the effects of nullsets. They connect to the more standard setting for measure theory as follows: Given a $\sigma$-algebra $(X,\Sigma)$ and a measure on $(X,\Sigma)$, dividing out the nullsets out of $\Sigma$ is guaranteed to yield a measure algebra. This is a surprising, since the $\sigma$-algebra doesn't need to have infinite joins or meets, but the measure algebra does have them. One can also conversely construct a measure space on a $\sigma$-algebra out of a measure algebra by using the Stone space of the measure algebra. For many more details on measure algebras, see chapter 32 of \cite{fremlin}, a notably long reference on measure theory.

\begin{example} \label{interval_examples}
\begin{itemize}
\item Let $(A,\mu)$ be an atomless probability algebra. Let $a \in A$ with $\mu(a) = r$ and let $s \in [0,r]$. We use the axiom of choice to construct an element of measure $s$. Consider the set
\[
S := \{ b \leq a | \mu(b) \leq s \}.
\]
Since every chain has a supremum, we can use Zorn's lemma to get a maximal element $b \in S$. Now consider the set
\[
T := \{ b' \leq a | b' \geq b\} .
\]
This has a minimal element $b'$ given by the meet of all elements of $T$. Note that $\mu(b') \geq s$ since $b' \geq b$. Thus, for all $c$ with $b \leq c \leq b'$, $c$ must either be $b$ or $b'$. This implies that $b' \wedge \neg b$ is an atom, or that $b' = b$. But the former is impossible due to the atomless hypothesis. Thus we have constructed an element of measure $s$, which means that $(A,\mu)$ is an interval.
\item Let $I$ denote the boolean probability algebra defined by the boolean algebra of Borel-subsets of the interval modulo the ideal of null-sets. Note that we can equivalently divide out the null-sets out of the boolean algebra of Lebesgue-subsets of the interval. Let $(I, \lambda)$ denote this boolean algebra equipped with the Lebesgue measure, and call $(I, \lambda)$ the Lebesgue interval. This is an atomless measure algebra, so the Lebesgue interval $(I, \lambda)$ is actually an interval.
\item More generally, any radon measure gives rise to an atomless measure algebra and thus also gives rise to an interval.
\item Note that not all intervals are atomless probability algebras. Consider the subalgebra
\[
A = \{(x_i) \in \prod_{i=1}^{\infty} I | \text{ finitely many } x_i \neq 0 \text{ or finitely many } x_i \neq 1 \}
\]
of the product of boolean algebras $\prod_{i \in \mathbb{N}} I$, where $(I, \lambda)$ is the Lebesgue interval. For some intuition on product boolean algebras, see \ref{partitions}. $A$ is the boolean algebra generated by elements that are everywhere zero except at one index. Note that $A$ is not complete and we have a measure on this boolean algebra defined by
\[
\mu((x_i)) := \sum_{i=1}^{\infty} 2^{-i} \lambda(x_i) ,
\]
where $\lambda$ denotes the Lebesgue measure on the $i$th Lebesgue interval. It can be easily seen that the defined boolean probability algebra is actually an interval.
\end{itemize}
\end{example}


\begin{theorem} \label{classifying}
The topos $Sh(FinProb,J_{at})$ classifies the theory $\mathbb{T}_{int}$. Moreover, $U$ is the universal model that gives us the required equivalence.
\end{theorem}
\begin{proof}
We use \cite{caramello_book}, corollary 8.1.14 and \ref{classifying_presheaf} in order to get that $Sh(FinProb,J_{at})$ classifies $\mathbb{T}_{bpalg}$ together with an axiom
\[
\phi_{\alpha}^{\vec{b}} \vdash_{\vec{b}} (\exists \vec{a}) \theta_f^{\vec{a},\vec{b}}
\]
for each morphism $f: \alpha \to \beta$ in $FinProb$. One can easily see that the axioms
\[
\phi_{U_{r+s,t}}^{\vec{b}} \vdash_{\vec{b}} (\exists \vec{a}) \theta_f^{\vec{a},\vec{b}}
\]
suffice, where $f: U_{r,s,t} \to U_{r+s,t}$ joins the first two elements. Note that $r,s$ and $t$ denote any elements in $[0,1]$. Now, the axioms above are precisely reformulations of the interval axioms.

Now we compute the universal model. By the way that the equivalence in \cite{caramello_book}, corollary 8.1.14 is constructed \footnote{One can use the commutative square in theorem 8.1.3 to see this, with a similar argument as in the remark below.}, the universal model is the sheafification on $U$. But we can show that $U$ is already a sheaf by using \ref{sheaf_condition_weak}. This tells us that $p_1^{-1}(a) = p_2^{-1}(a)$, which means that

\[
\forall x,y \text{ such that } f(x) = f(y): x \in a \Leftrightarrow y \in a .
\]
This is equivalent to the fact that
\[
\forall x \in X: f^{-1}(x) \cap a \text{ is } \emptyset \text{ or } f^{-1}(x) .
\]
But this means, that we can lift the subset $a \in U(\alpha)$ to a subset $b \in U(\beta)$, and the subset clearly must be unique.

Thus we can conclude that $U$ is in fact the universal model in $Sh(FinProb, J_{at})$.
\end{proof}

\begin{remark} \label{classifying_equiv_data}
Using the commutative square(it only commutes up to isomorphism) for any Grothendieck topos $\mathcal{E}$
\[
\begin{tikzcd}
\mathbb{T}_{int}\text{-}mod(\mathcal{E}) \arrow[d] \arrow[r, "\simeq"] & {Geom(\mathcal{E},Sh(FinProb,J_{at}))} \arrow[d, "j \circ -"] \\
\mathbb{T}_{bpalg}\text{-}mod(\mathcal{E}) \arrow[r, "\simeq"]         & {Geom(\mathcal{E},Set^{FinProb^{op}})}                       
\end{tikzcd}
\]
in theorem 8.1.3 in \cite{caramello_book}, one can extract more information about how to compute the equivalence. Here $j$ denotes the sheafification functor. First, note that the inclusion on the left hand side is fully faithful and that the functor on the bottom is given by the functor in \ref{inverse}. Thus we can choose the equivalence on the top such that it is precisely defined by the interpretation in \ref{inverse}.

Thus, we can explicitly describe the equivalence of categories
\[
    \mathbb{T}_{int}\text{-}mod(\mathcal{E}) \simeq Geom(\mathcal{E},Sh(FinProb,J_{at}))
\]
by giving the functor going to the right as the interpretation in \ref{inverse} and the functor going to the left by Yoneda embedding the universal model $U$.

In particular, if we have a model $(A,\mu)$ of $\mathbb{T}_{int}$ in $Set$, we can view it as a geometric morphism $Set \to Sh(FinProb, J_{at})$ by specifying it as the $J_{at}$-flat functor $FinProb \to Set$ given by sending a finite probability space $(X,\nu)$ to the set
\[
\{(a_i)_{i \in X} | a_i \in A \text{ are pairwise disjoint, } \nu(a_i) = \mu(i) \}
\]
and by sending a map $(X,\nu_1) \to (Y,\nu_2)$ the map
\[
(a_j)_{j \in X} \mapsto \big (\bigvee_{f(j) = i} a_j \big )_{i \in Y} .
\]
\end{remark}

\begin{corollary}
Every infinitary first-order formula over the signature of $\mathbb{T}_{int}$ is provably equivalent to $\top$ or $\bot$ in $\mathbb{T}_{int}$.
\end{corollary}
% This result is particularly remarkable. The study of the geometric logic of $Sh(FinSet, J_{at})$ corresponds to the study of geometric statements over the boolean probability algebra signature on $(I, \lambda)$. Thus $\mathbb{T}_{int}$ can be thought as a synthetic context for studying geometric properties of the measure-theoretic interval.


\section{$\mathfrak{Prob}$ as a topos of continuous group actions}

We seek to apply the following result due to O.Caramello:

\begin{theorem}\label{olivia}
Let $\mathcal{C}$ be a small, inhabited category satisfying the amalgamation and joint-embedding properties, and let $u$ be a $\mathcal{C}$-universal and $\mathcal{C}$-ultrahomogeneous object in $Ind(\mathcal{C})$. Then the collection $\mathcal{I}_{\mathcal{C}}$ of sets of the form $\mathcal{I}_{\chi}:=\{f:u\overset{\sim}{\rightarrow} u| f\circ \chi=\chi\} $, for an arrow $\chi:c\rightarrow u$, form an object $c$ of $\mathcal{C}$ to $u$ defines an algebraic base for the group of automorphisms of $u$ in $Ind(\mathcal{C})$, and, denoted by $Aut_\mathcal{C}$ the resulting topological group, we have an equivalence of toposes
\[\text{Sh}(\mathcal{C}^{op},J_{at})\simeq \text{Cont}(Aut_\mathcal{C}) \]
induced by the functor $F:\mathcal{C}^{op}\rightarrow \text{Cont}(Aut_{\mathcal{C}})$ which sends any object $c$ of $\mathcal{C}$ to the set $Hom_{Ind(\mathcal{C})}(c,u)$ equipped with the action by post-composition and any arrow $f:c\rightarrow d$ in $\mathcal{C}$ to pre-composition by $f$.
\end{theorem}

In our context we set $\mathcal{C}=BPAlg_f$ and will show that the Lebesgue interval is $BPAlg_f$-universal and $BPAlg_f$-ultrahomogeneous. But before we do that, we need some remarks that will be used in our proof.

\begin{remark}\label{partitions}
For an element $a \in B$ of a boolean algebra, we will denote the ideal of elements of $B$ that are less than or equal to $a$ by $I(a)$.
\begin{enumerate}
\item In the category of boolean algebras, if one has a \\ boolean algebra $A$, we get the following correspondence between decompositions $A \cong B \times C$ and partitions $a,b$ (i.e. pairs of elements $a,b$ with $a \vee b = 1$ and $a \wedge b = 0$). A decomposition $B \times C$ induces the partition $(1,0), (0,1)$ on $A$ and conversely the partition $a,b$ induces the decomposition \\ $A \cong I(a) \times I(b)$. This lets us interpret the product of boolean algebras as some sort of disjoint union.
\item The interesting thing about this description of products, is that it shows that if we have a map $A \to B$ of boolean algebras and we have a decomposition $A \cong A_1 \times A_2$, then this induces a decomposition of $B$.
\item Given two boolean probability algebras $(A, \mu)$ and $(B, \nu)$, there is a measure $(\mu + \nu)(x,y) := \mu(x) + \nu(y)$ on $A \times B$. Unfortunately, this can't be the product in $BPAlg$, because $\mu + \nu$ is not a probability measure nor are the projections measure-preserving.
\end{enumerate}
\end{remark}

We could now start proving that the Lebesgue interval satisfies the required properties, but in order to emphasize that the Lebesgue interval is not really special, we will will prove that a well-known more general class of measure algebras is $BPAlg_f$-universal and $BPAlg_f$-ultrahomogeneous. The reader can ignore this and pretend that he is dealing with the Lebesgue interval.

\begin{definition} \label{maharam_type_homogeneous}
\begin{enumerate}
\item Let $A$ be a complete boolean algebra. We say that a subset $S \subset A$ generates $A$ if $A$ is the only complete boolean subalgebra of $A$ containing $S$.
\item Let $A$ be a complete boolean algebra. We say that the Maharam type of $A$ is the smallest possible cardinality of a generating set.
\item We moreover say that $A$ is Maharam-type-homogeneous if the Maharam type of every nonzero principal ideal $I(a)$ is the same.
\item Call a measure algebra Maharam-type-homogeneous if its underlying boolean algebra is Maharam-type homogeneous.
\end{enumerate}
\end{definition}

For more information on Maharam-type-homogeneous measure algebras, see chapter 33 of \cite{fremlin}. The crucial fact about Maharam-type-homogeneous measure algebras, is they are isomorphic if and only if they have the same Maharam type and the top element $1$ has the same measure on both measure algebras(see 331I of \cite{fremlin}). Moreover, there is a surprising theorem by Maharam (see 332J in \cite{fremlin}) that lets us decompose any atomless measure algebra into Maharam-type-homogeneous measure algebras.

Now we actually show that homogeneous-Maharam-type probability algebras are $BPAlg_f$-universal and $BPAlg_f$-ultrahomogeneous. More concretely, we prove the following for a Maharam-type-homogeneous probability algebra $(M, \alpha)$:

\begin{lemma}\begin{enumerate}
\item $FinProb$ has a terminal object, proving the joint embedding property.
\item $FinProb$ fulfills the right Ore condition.
\item For any $(A,\mu),(B,\nu)$ in $BPAlg_f$ , an arrow $f:(A,\mu)\rightarrow (B,\nu)$ in \\
 $BPAlg_f$, and arrows $\chi_1:(A,\mu)\rightarrow (M, \alpha)$ as well as $\chi_2:(B,\nu)\rightarrow (M, \alpha)$ in $BPAlg$ there exists an isomorphism $j':(M, \alpha) \rightarrow (M, \alpha)$ such that $j'\circ \chi_1=\chi_2\circ j$:
 \begin{center}
 \begin{tikzcd}
{(A,\mu)} \arrow[r, "\chi_1"] \arrow[d, "j"'] & {(M, \alpha)} \arrow[d, "j'", dotted] \\
{(B,\nu)} \arrow[r, "\chi_2"']                & {(M, \alpha)}                        
\end{tikzcd}
 \end{center}
\item For any object $(A,\mu)$ of $BPAlg_f$ there exists an arrow $\chi:(A,\mu)\rightarrow (M, \alpha)$ in $BPAlg$.
\end{enumerate}
\end{lemma}
\begin{proof} 
\begin{enumerate}
\item The one-element set $\{*\}$ with with measure $\mu(\star)=1$ is the terminal object. Its underlying set the terminal object in $Set$ and the universal map is tautologically measure preserving.
\item We have already shown this in \ref{pullback_measure}.
\item
Now, given boolean probability algebras as in the claim above, we see that $(A, \mu)$ has a partition into atoms $x_i$. Crucially, if we apply a map of boolean algebras to this partition, we get a partition again. This means we can decompose our problem(by \ref{partitions}) into finding a measure-preserving map $j'$ as below:
\[
\begin{tikzcd}
2 \arrow[d, "j"'] \arrow[r, "\chi_1"]  & I(\chi_1 x_i) \arrow[d, "j'", dotted] \\
I(j x_i) \arrow[r, "\chi_2"'] & I(\chi_2 j x_i)                      
\end{tikzcd}
\]
Since $2 := \{0, 1\}$ is the initial object in boolean algebras, it suffices to show that we have an isomorphism of measure algebras
\[
I(\chi_1 x_i) \cong I(\chi_2 j x_i)
\]
for each $i$. Now both of these measure algebras are Maharam-type-homogeneous and have the same Maharam type, since $(M, \alpha)$ was Maharam-type-homogeneous. Moreover, the top element $1$ has the same measure in both algebras, so we can now use 331I in \cite{fremlin} in order to get our isomorphism.

\item A measure-preserving map $\chi:(\mathcal{P} X,\mu)\rightarrow (A,\mu)$ consists of precisely a partition of $(A,\mu)$ into finitely many elements of predetermined measure. But this is precisely the interval property for atomless measure algebras, see \ref{interval_examples}.

% \item $f_1(\mathcal{B}_1)$ and $f_2(\mathcal{B}_2)$ are subalgebras of $I$, so we may generate the smallest subalgebra of them, containing both. Define $\mathcal{B}_3=\langle f_1(\mathcal{B}_1),f_2(\mathcal{B}_2) \rangle $ with the measure induced by the Lebesgue measure. As $f_1(\mathcal{B}_1)$ and $f_2(\mathcal{B}_2)$ are isomorphism to $\mathcal{B}_1$ resp. $\mathcal{B}_2$, the diagram commutes. It remains to show that $\mathcal{B}_3$ is finite (resp. at most countable). This is obvious, however any element of it may be represented as the unions of intersections of atoms $b_1\wedge b_2$ of $b_1\in \mathcal{B}_1$, $b_2\in\mathcal{B}_2$.
\end{enumerate}
\end{proof}

\begin{remark}
Notice that by using 331I in \cite{fremlin} we have implicitly used the axiom of choice.
\end{remark}

\begin{corollary}\label{Galois} Let $(M, \alpha)$ be a homogeneous-Maharam-type probability algebra. Let $G$ be the group of automorphisms of $(M, \alpha)$ topologised via an algebraic base given by collections $\mathcal{M}_{\chi}:=\{f:u\overset{\sim}{\rightarrow} u| f\circ \chi=\chi\} $ of automorphisms fixing a finite partition $\chi: (A,\mu)\rightarrow (M, \alpha)$. Then we get an equivalence of toposes, which is induced as in \ref{olivia}:
\[\text{Sh}(FinProb, J_{at})\simeq \text{Cont}(G)\]
\end{corollary}
\begin{remark} In the case of the Lebesgue interval, its automorphisms are commonly known as \emph{measure-preserving dynamical systems}. This shows that our topos is also deeply connected to ergodic theory.
\end{remark}
%It follows that the atoms of the topos correspond to open subgroups of $G$. We shall classify them. %give ref
\begin{proposition} The automorphism group of a homogeneous-Maharam-type probability algebra is simple by 383Ib \cite{fremlin}. In particular, all topos-theoretic invariants involving any sort of normal subgroup listed in \cite{caramello_lafforgue} are trivial.
\end{proposition}

\section{$\mathfrak{Prob}$ as a set-theoretical universe}

\begin{proposition} The internal language of $\mathfrak{Prob}$ is a classical model of ZFA (Zermelo-Frenkel with atoms or urelements). It is a so called \emph{Fraenkel-Mostowski model}. This is formulated as a single-sorted first order language with equality $=$, membership relation $\in$ and a constant $A$ set of atoms and fulfilling the following axioms:
\begin{center}\begin{tabular}{ |p{3.5 cm}|p{7.5 cm}| }
\hline
Decidability&  $\forall x. (x\in A\vee \neg(x\in A))$  \\ % This seems to be obsolete in classical interpretations
\hline
Set & $\forall y. (\exists x.x\in y\implies \neg (y\in A))$\\
\hline
Extensionality & $\forall x,y. \neg(x\in A)\wedge \neg(y\in A)\implies [ x=y\iff \forall z.(z\in x \iff z\in y) ] $\\
\hline
Pairing & $\forall x,y \exists z. (x\in z \wedge y\in z)$ \\
\hline
Separation & $\forall x \exists y. \neg (y\in A)  \wedge\exists z. (z\in y\iff z\in x \wedge \phi)$ for $x$ not free in $\phi$. \\
\hline
Union &$\forall x \exists y\forall z. (z\in y\iff \exists w\in x.z\in w)$ \\
\hline
Power-set &$\forall x\exists y \forall z. (z\in y\iff \forall w\in z.w\in x)$ \\
\hline
Infinity & $\exists x(\exists y.y\in x\wedge \forall y\in x.\exists w\in x.y\in w)$\\
\hline
$\in$-induction &$\forall x.(\forall y\in x. \phi(y)\implies \phi(x))\implies \forall x.\phi(x)$ \\
\hline
Collection & $\forall x (\forall y\in x\exists w.\phi\implies \exists z\forall y\in x \exists w\in z. \phi)$\\
\hline 
\end{tabular}
\end{center}
\end{proposition}
\begin{proof} Quote [ref: sheaf models for set theory] chapter 2 and 3 \newline%later we will also use chapter 5
\indent In any of the continuous group action interpretations, the subobject classifier resp. natural numbers object is given by the two element set resp. $\mathbb{N}$ with trivial actions. The exponentials are computed as sets of maps $X\rightarrow Y$ whose stabilizer under the action $g.f(x)=g.f(g^{-1}.x)$ is open. $A$ is interpreted as $\bigsqcup_{gH\text{is coset of open subgroup}} gH$. Equality is equality but how to get a global membership relation is a bit less obvious. One uses an analogue of the cumulative hierarchy, starting with the set of atoms and then taking power objects and directed colimits just as one would in set-theory. On each of these objects one gets a membership relation using the cartesian closed structure of our topos. So at least presenting the topos using the skeleton given by elements of the objects in the hierarchy, one obtains a classical model of ZFA as described above.
\end{proof}
Again, it would be nice to have a more combinatorial, workable interpretation of these objects. First we need to classify the atoms (as sheaves on the atomic site on $FinProb$) and thereby inadvertently the open subgroups of our topological groups.\newline

We will utilize the combinatorial method outlined in [Lafforge, Olivia] Prop 6.7. For this, we will need to understand internal equivalence relations on the sheaves $yU_{r_1\cdots r_n}$ as the atoms will be reconstructed as quotients of these relations. We use \ref{multipullback} to yield the following description of an equivalence relation. \newline
\indent It is a subobject 
\[R\hookrightarrow yU_{r_1\cdots r_n}\times yU_{r_1\cdots r_n}=\bigsqcup_{\substack{\sum_i t_{ij}=r_j \\ \sum_j t_{ij}=r_i}  }yU_{t_{ij}}\]
As these representable functors are atoms, this is equivalent to giving a subset of the set $S_{r_1\cdots r_n}:=\{(t_{ij})_{0\leq i,j \leq n} | \sum_i t_{ij}=r_j,\, \sum_j t_{ij}=r_i \}$ of matrices whose rows and columns sum to the $r_i$'s. Now we use Definition 6.5 (iii) to check when this is an equivalence relation.
\begin{enumerate}
\item Reflexivity:  The element induced by the diagonal $\Delta: yU_{r_1\cdots r_n}\rightarrow $\linebreak $ yU_{r_1\cdots r_n}\times yU_{r_1\cdots r_n}$ is in $R$ i.e. the following matrix is in $R$:
\[ \begin{bmatrix}
    r_{1}       & 0 & \dots & 0 \\
    0      & r_2 &  \dots &0 \\
    \vdots & \vdots &  \ddots& \vdots\\
    0       & 0& \dots & r_n
\end{bmatrix} \] 
\item Symmetry: $R$ is invariant under swapping the factors of the product $ yU_{r_1\cdots r_n}\times yU_{r_1\cdots r_n}$ i.e. if $T\in R$ then so is its conjugate $T^\top$.
\item Transitivity: Given $(t^{(1)}_{ij})\in R$ and $(t^{(2)}_{jk})\in R$ and $(t_{ijk})$ corresponding to an atom of $yU_{r_1\cdots r_n}\times yU_{r_1\cdots r_n} \times yU_{r_1\cdots r_n}$ such that its images in the product of the first resp. last two components are $(t^{(1)}_{ij})$ resp. $(t^{(2)}_{jk})$ i.e.:
\[\sum_k t_{ijk}=t^{(1)}_{ij} \quad \sum_i t_{ijk}=t^{(2)}_{jk} \]
Then its image in the product of the first and third component lies in $R$ i.e.:
\[(t^{(3)}_{ik})\in R \text{ where }t^{(3)}_{ik}:=\sum_j t_{ijk}    \]
Geometrically:
%Geometrically, this means that for every $3$-dimensional matrix with values in $\mathbb{R}_{\geq 0}$, if the sums of the entries in two of the directions are  matrices in $R$, then so is the third:
\end{enumerate}
\begin{center}
\begin{tikzcd}[row sep=small, column sep= small]
             & t^{(2)}_{n1}                                  &              & t^{(2)}_{nn}                                                     &              &                                               &              \\
t^{(3)}_{n1} & t_{n11} \arrow[l, "\sum"'] \arrow[u, "\sum"'] & \cdots       & t_{n1n} \arrow[u, "\sum"']                                       &              &                                               &              \\
             & \vdots                                        & \ddots       & t_{11}^{(2)}                                                     & \ddots       & t^{(2)}_{1n}                                  &              \\
t^{(3)}_{nn} & t_{nn1} \arrow[l, "\sum"']                    & t^{(3)}_{11} & t_{111} \arrow[rd, "\sum"] \arrow[l, "\sum"'] \arrow[u, "\sum"'] & \cdots       & t_{11n} \arrow[rd, "\sum"] \arrow[u, "\sum"'] &              \\
             &                                               & \ddots       & \vdots                                                           & t^{(1)}_{11} & \vdots                                        & t^{(1)}_{1n} \\
             &                                               & t^{(3)}_{1n} & t_{1n1} \arrow[rd, "\sum"] \arrow[l, "\sum"']                    & \cdots       & t_{1nn} \arrow[rd, "\sum"]                    &              \\
             &                                               &              &                                                                  & t^{(1)}_{n1} &                                               & t^{(1)}_{nn}
\end{tikzcd}
\end{center}
\indent We call such sets equivalence relations. One can generate an equivalence relation by intersecting all those, which contain a given set of the matrices. This can be seen as some kind of \emph{game}, where on starts with some matrices and then constructs all other possible ones with these $3$ "moves".

%We dont really need these examples anymore right?

\begin{example}[Block diagonal forms]
Given a partition $A_1\cup\cdots\cup A_m=\{1,\cdots, n\}$ into non-empty disjoint sets, consider the set $R\subseteq S_{r_1\cdots r_n}$ of matrices $(t_{ij})$, such that the only nonzero entries are at the indices $i\in A_l, j \in A_l$ for some $l$. This is an equivalence relation.
\end{example}

We can generalize this example.

\begin{example}[Block diagonal forms with permutations]
Again, fix a partition $A_1\cup\cdots\cup A_m=\{1,\cdots, n\}$ into non-empty disjoint sets. Additionally, fix a subgroup $H$ of the following group of permutations on $m$ elements:
\[
\big \{ \sigma \in S_m | \sum_{i \in A_m} r_i = \sum_{i \in A_{\sigma(m)}} r_i \big \}\footnote{This group is isomorphic to the group of measure preserving automorphisms of the finite probability space with elements of measure $r_1, \cdots, r_m$.}
\]
Consider the set $R\subseteq S_{r_1\cdots r_n}$ of matrices $(t_{ij})$, such that for some $\sigma \in H$ the only nonzero entries are at the indices $i\in A_{\sigma(l)}, j \in A_l$ for some $l$. This is an equivalence relation.

One can analyze in more detail how the permutations dictate where the non-zero entries can be and how this interacts with the equivalence relation axioms. Reflexivity corresponds to the identity permutation. Symmetry corresponds to transposition of the matrix and thus to taking the inverse permutation. Given matrices $(t^{(1)}_{jk})\in R$ and $(t^{(2)}_{ik})\in R$, where for the first matrix, the permutation $\sigma$ dictates where the nonzero entries can be and for the second matrix, $\tau$ dictates where the non-zero entries can be, the possible matrices $(t^{(3)}_{ij})\in R$ that can be yielded will have non-zero entries dictated by the permutation $\tau^{-1} \sigma$.

This motivates the fact that we actually want $H$ to be a subgroup.
\end{example}
%We probably don't need these examples
Now before we prove that these already describe all the equivalence relations, we need some theorems from actual combinatorics/ optimal transport. Similar constructions have already been investigated under the name "3-way axial transportation polytope".%This remark is obsolete. But I think we should include as many autistic "maybe it's connected to XYZ" remarks as possible
\begin{definition} Given a non-negative real matrix $M\in \mathbb{R}^{n^2}_{\geq 0}$, define the \emph{graph }$\Gamma(M)$\emph{ of }$M$ as the bipartite graph on $\{1, \cdots, n\}\sqcup \{1, \cdots, n\}$ with an edge between $i$ and $j$ iff $M_{ij}\neq 0$. One can also interpret this as a $(0,1)$-matrix.
\end{definition}
\begin{lemma}\label{2x2x2} Given $0<r_1<1$, setting $r_2=1-r_1$, and  a matrix $\begin{bmatrix}
r_1-a & a\\
a &r_2-a
\end{bmatrix}$ with $0\neq a \leq r_1,r_2$, $a\neq 1/2$, the equivalence relation on $yU_{r_1 r_2}$ generated by it are already all matrices in $S_{r_1r_2}$. 
\end{lemma}
\begin{proof} WLOG $r_1\geq r_2$. All matrices in $S_{r_1r_2}$ are of the form as in the statement of the lemma (without the restrictions $a\neq 0,a\neq  1/2$). If we set $t^{(1)}_{ij}=t^{(2)}_{jk}=\begin{bmatrix}
r_1-a & a\\
a &r_2-a
\end{bmatrix}$ then the matrix $t_{ijk}$ has to be if the following form:
\[t_{i1k}=\begin{bmatrix}
r_1-a-b & b\\
b & a-b
\end{bmatrix} \quad t_{i2k}=\begin{bmatrix}
a-c & c\\
c & r_2-a-c 
\end{bmatrix}\]
for $b\leq \min \{a, r_1-a \}$, $c\leq \min \{a,r_2-a\}$. Hence:
\[ t_{ik}^{(3)}=\begin{bmatrix}
r_1-b-c &b+ c\\
b+c & r_2-b-c 
\end{bmatrix}
\]
Setting $a'=b+c$, these are precisely all the matrices such that $a'\leq \min\{2a, r_1, r_2, r_1+r_2-2a   \}=\min \{2a,r_2, 1-2a \}$. We will iteratively expand the set of  values $a$ such that the equivalence relation generated by them is $S_{r_1r_2}$. 
Clearly this holds for all $a\in [\frac{r_2}{2},\frac{ r_1}{2}  ]$ (and $a\leq r_2$ we will always implicitly assume this condition in what follows).\newline
\indent For $n\geq 1$ and $a\in [\frac{r_2}{2^{n+1}},\frac{r_2}{2^n})\cup (\frac{1}{2}-\frac{r_2}{2^n}, \frac{1}{2}-\frac{r_2}{2^{n+1}}] $, choose $a'=\frac{r_2}{2^n}$. Thus for any starting point $a\in (0,\frac{1}{2})$, we can generate, after finitely many steps, some $a\in  [\frac{r_2}{2},\frac{ r_1}{2}  ]$ and hence everything. 
\end{proof}
\begin{theorem}
The atoms of the topos $\mathfrak{Prob}$ correspond to tuples $(M, \mu, U)$ where $(M,\mu)$ is a finite probability space and $U\leq Aut(M,\mu)$ a subgroup of its automorphism group.
\end{theorem}
\begin{proof}
Given an equivalence relation $R$ on $yU_{r_1\cdots r_n},$ we will conclude the proof via a sequence of reduction steps.\newline
\newline
\emph{Step 1.} If there exists a matrix $M\in R$ such that the associated $(0,1)$-matrix is not a permutation matrix then there exists a node $l\in \{1,\cdots,n\} \sqcup\{1,\cdots,n\}$in its graph with at least two neighbours, WLOG, by reordering, the nodes $1$ and $2$. By symmetry, we may assume $l$ lies in the first component. Setting, as in the description of transitivity as before, $t^{(1)}_{ij}=M$, $t^{(2)}_{jk}=M^\top$, we seek to find an appropriate $n\times n \times n$-matrix for some matrix $L$ in the following block diagonal form
\[ \begin{bmatrix}
    a_{11}      & a_{12} & 0&\dots & 0 \\
    a_{21}     & a_{22} &  0&\dots &0 \\
    0 & 0& r_3 &\dots & 0\\
    \vdots & \vdots & \vdots &  \ddots& \vdots\\
    0       & 0& 0 & \dots & r_n
\end{bmatrix} \] 
such that $a_{ij}\neq 0$. One can achieve this by setting for $j\neq l$: $t_{ijk}=\begin{cases}  m_{ij} &\text{if }i=k \\ 0 & \text{else}  \end{cases}$ and $(t_{ilk})_{0\leq i,k\leq n}$ to be the following matrix for some $\min\{m_{1l},m_{2l}\}>\epsilon> 0$:
\[ \begin{bmatrix}
    m_{1l}-\epsilon  & \epsilon & 0&\dots & 0 \\
  \epsilon     &m_{2l}-\epsilon &  0&\dots &0 \\
    0 & 0& m_{3l} &\dots & 0\\
    \vdots & \vdots & \vdots &  \ddots& \vdots\\
    0       & 0& 0 & \dots & m_{nl}
\end{bmatrix} \] 
$L$ is then defined to be the sum of these matrices.
\newline
\newline
\emph{Step 2.} Now we can generate the smallest equivalence relation containing $L$. We set $t_{ij}^{(1)}=t^{(2)}_{jk}=L$ and construct all 3-dimensional matrices $t_{ijk}$ with these faces. Clearly, for tuples $ijk$ such that at least one $i>2$, $j>2$ or $k>2$, we must have $t_{ijk}=\begin{cases} r_i &\text{if }i=j=k \\ 0 &\text{else}  \end{cases}$. Hence the problem reduces (up to scaling) to the statement of the previous lemma \ref{2x2x2}. It is applicable as non of the entries are zero and hence the $a$, in the notation of the lemma, is neither $0$ nor $\frac{1}{2}$. The smallest equivalence relation containing $L$ is thus the set of all matrices in the same block-diagonal form as $L$. This can easily be seen to be the equivalence relation $R_{1,2}$ associated the quotient map  $yU_{r_1\cdots r_n}\rightarrow yU_{(r_1+r_2),r_3\cdots r_n}$ sending $1, 2\mapsto 1$ and $j\mapsto j-1$ for $j> 2$.
\newline
\newline
\emph{Step 3.} Replace $R$ on $yU_{r_1\cdots r_n}$ by  the equivalence relation $\tilde{R}$ on $yU_{(r_1+r_2),r_3\cdots r_n}$ defined as what is left over after quotienting out $R_{1,2}$. Repeat these steps until the condition of step 1 is no longer fulfilled. This will terminate as $n$ is finite.\newline
\newline
\emph{Step 4.} The $(0,1)$-matrices of all matrices in $R$ are permutation matrices. The conditions on matrices in $S$ impose that these matrices are automorphisms of $U_{r_1\cdots r_n}$. It remains to prove that they form a subgroup of $S_n$. One can check that $\sigma^\top=\sigma^{-1}$ and the only matrix that can appear as $t^{(3)}_{ik}$ if we set $t^{(1)}_{ij}=\sigma$ and $t^{(2)}_{jk}=\tau$, is $\sigma \tau^{-1}$. It also contains the unit of $S_n$ by reflexivity. Hence it is a subgroup.
\newline
\newline
This concludes the proof as all atoms are quotients of equivalence relations and the relations, that we found in this proof are genuinely non-isomorphic. [insert pretty argument]. The representable functors appear as $(X,\mu, \{id\})$.
\end{proof}
\begin{lemma} Given a finite probability space $(X,\mu)$ and a subgroup $U$ of its automorphism group, we compute the sheaf-theoretic quotient of the corresponding equivalence relation in $\text{Sh}(FinProb,J_{at})$ to be:
\[ \mathcal{F} :(N,\nu)\mapsto\text{FinProb}((N,\nu), (M,\mu))/\sim  \]
where $f\sim g$ if there exists $\sigma\in U$ with $ \sigma\circ f=g$. These are partitions up to permutation by elements in $U$.
\end{lemma}
\begin{proof}
One calculates coequalizers in sheaf topoi by calculating the section-wise coequalizer and then sheafifying. Sheafification is not needed in our case however as the presheaf given in the statement is a sheaf:  We seek to apply the criterion \ref{sheaf_condition_weak}. We need to check that the following is an equalizer diagram for any $f:(Z,\lambda)\rightarrow (Y,\nu)$:
\[
\begin{tikzcd} \mathcal{F} (Y,\nu) \arrow[r, "\mathcal{F}f"] & \mathcal{F} (Z,\lambda) \arrow[r, "\pi_1", shift left] \arrow[r, "\pi_2"', shift right] & \mathcal{F} (Z \times_f Z,\bar{\lambda})
\end{tikzcd} ,
\]
For any measure-preserving map $g: (Z,\lambda) \rightarrow (X,\mu)$ such that $g\circ \pi_1=\sigma \circ g\circ \pi_2$ for some $\sigma\in U$, we see that $f^{-1}\{y\} \cap g^{-1}\{x\} =f^{-1}\{y\} \cap g^{-1}\{\sigma^{-1}x\} \in \{f^{-1}\{y\} ,\emptyset \}$ for any $y\in Y$ and $x\in X$. Hence we can define $\tilde{g}: (Y,\nu)\rightarrow (X,\mu)$ via $y\mapsto x$ if $f^{-1}\{y\}\subseteq g^{-1}\{x\} $. This yields a map $ \mathcal{F} (Y,\nu)\rightarrow Eq(\pi_1, \pi_2)$. WHY IS THIS WELL DEFINED. WE NEED TO THINK ABOUT PERMUTATIONS ON Z
\end{proof}
\begin{remark} The automorphism groups aren't all that complicated. Note that $\text{Aut}(X,\mu)\simeq \prod_{r\in (0,1)} S_{\{x\in X| \mu(x)=r \}}$.
\end{remark}
\begin{definition} Define the \emph{category of atoms }$FinProb_{at}$\emph{ of }$FinProb$ as the full subcategory of $\mathfrak{Prob}$ of atoms.
\end{definition}
This yields a new site presentation, which is set theoretic in spirit.
\begin{proposition} $\mathfrak{Prob}\simeq \text{Sh}(FinProb_{at},J_{at})$. More concretely, $\mathfrak{Prob}$ is the $\infty$-positivisation of $FinProb_{at}$.
\end{proposition}
\begin{proof}
\cite{caramello_lafforgue}
\end{proof}
We are also equipped to characterise this category in combinatorial terms.
\begin{theorem} The category $FinProb_{at}$ is equivalent to the following category. Its objects are given by tuples $(M,\mu, U)$ where $(M,\mu)$ is a finite probability space and $U$ is a subgroup of its automorphism group. The morphisms $(M,\mu, U)\rightarrow (N,\nu, V)$ are given by measure-preserving functions such that ....
\end{theorem}
\begin{proof}
We can Yoneda embed $FinProb_{at}$ into $\mathfrak{Prob}$.  By the Yoneda lemma, a morphism $y(M,\mu)\rightarrow y(N,\nu)/R$ corresponds to an element of $(y(N,\nu)/R)(M,\mu)$. This has been computed to be .... A morphism $y(M,\mu)/R \rightarrow y(N,\nu)/R'$ is simply a morphism such that $y(M,\mu)\rightarrow y(N,\nu)/R'$ factors over $R$...
\end{proof}
%\begin{definition} 
%Given two vectors of non-negative real numbers $a, b\in \mathbb{R}^n_{\geq 0}$ such that $\sum_i a_i=\sum_j b_j$, define the \emph{transportation polytope} $\mathcal{N}(a,b)\subset \mathbb{R}^{n^2}_{\geq 0}$ of matrices $x_{ij}$ such that $\sum_i x_{ij}=b_j$ and $\sum_j x_{ij}=a_i$.
%\end{definition}
%\begin{definition} Given a non-negative real matrix $M\in \mathbb{R}^{n^2}_{\geq 0}$, define the \emph{graph }$\Gamma(M)$\emph{ of }$M$ as the bipartite graph on $\{1, \cdots, n\}\sqcup \{1, \cdots, n\}$ with an edge between $i$ and $j$ iff $M_{ij}\neq 0$.
%\end{definition}
%\begin{theorem}
%The extreme points $E(a,b)$ of the polytope $\mathcal{N}(a,b)$ can be, equivalently, described as follows:
%\begin{enumerate}
%\item Matrices $M\in \mathcal{N}(a,b)$ with $\Gamma(M)$ a forest. 
%\item Matrices $M\in \mathcal{N}(a,b)$ such that there exists no different $N\in \mathcal{N}(a,b)$ such that  $\Gamma(N)$ is a subgraph of $\Gamma(M)$.
%\end{enumerate}
%The forest which appear (and then uniquely appear) as graphs of matrices in $\mathcal{N}(a,b)$ can be described as forests $\gamma$ such that the following conditions are fulfilled:
%\begin{enumerate}
%\item If $\gamma_0\subseteq \gamma$ is a connected component with vertices $A\sqcup B$ then $\sum_{i\in A} a_i=\sum_{j\in B} b_j$.
%\item For any vertex $i$ in the first component of $\{1, \cdots, n\}\sqcup \{1, \cdots, n\}$, we have $a_i\leq \sum_{j\text{ is a neighbor of }i} b_j$
%\item Given $A\sqcup B\subset \{1,\cdots, n\}\sqcup \{1,\cdots, n\}$ such that there are no edges in $\gamma$ from $i\in A$ to $j\in \{1,\cdots, n\}\setminus B$, then 
%\[ \sum_{i\in A} a_i\leq \sum_{j\in B} b_j\]
%\item Equality holds iff there are also no edges from $i\in \{1,\cdots, n\}\setminus A$ to $j\in B$.
%\end{enumerate}
%\end{theorem}
%\begin{proof}
%The first statement is just 8.1.2 of [matrix trash]. This follows from 8.1.7 \emph{ibid.} by noting that for forests, if there exists a matrix in $\mathcal{N}(a,b)$ with it as its %graph, it is unique. %8.4.3, 8.4.6 might also be interesting
%\end{proof}
%\begin{lemma} Given matrices $M, N\in S=\mathcal{N}(r,r)$ we can characterise the polytope $\mathcal{N}(M,N)\subset S$ of matrices $L$ such that there exists a 3d matrix $t_{ijk}$ such that $t^{(1)}_{ij}=M,\, t^{(2)}_{jk}=N, \, t^{(3)}_{ik}=L$. Its set of extreme points is the element-wise sum $\sum_{j} E(M_j, N_j)$ where $M_j$ resp. $N_j$ are the $j$-th column resp. row vectors of the matrices. In particular, the extreme points of $\mathcal{N}(M,N)$ which are also extreme points of $\mathcal{N}(r,r)$ can be described as follows:\newline
%\indent Matrices $K\in \mathcal{N}(r,r)$ with forests $\Gamma(K)$ such that there exist matrices $K_j\in E(M_j, N_j)$ with $\Gamma(K_j)\subseteq \Gamma(K)$.
%\end{lemma}
%\begin{proof}
%The matrices in $\mathcal{N}(M,N)$ are computed by adding up matrices in $\mathcal{N}(M_j,N_j)$ level-by-level in the 3d-matrix, so the first statement follows.%\newline
%\indent Now let $L\in E(r,r)$ be a matrix in $\mathcal{N}(M,N)$ and choose some 3d matrix $t_{ijk}$ such that $t^{(1)}_{ij}=M,\, t^{(2)}_{jk}=N, \, t^{(3)}_{ik}=L$. For fixed $j$, the matrices $T_{ik}^j=t_{ijk}$ have to have graphs $\Gamma (T_{ik}^j)\subseteq \Gamma(L)$ as all matrices have only non-negative entries so $\Gamma(L)=\bigcup_j \Gamma (T_{ik}^j)$. Hence if $\Gamma(L)$ is a forest, so are all the $\Gamma (T_{ik}^j)$.\newline 
%\indent Conversely, given a graph $\Gamma(K)$ for some matrix $K\in \mathcal{N}(r,r)$ and matrices $K_j\in E(M_j,N_j)$ with $\Gamma(K_j)\subseteq \Gamma(K)$ then $\Gamma(\sum_j K_j)\subseteq \Gamma(K)$. But the only matrix inside $\mathcal{N}(r,r)$ with a graph contained in $\Gamma(K)$, is $K$ whence $\sum_j K_j=K\in \mathcal{N}(M,N)$.
%\end{proof}
%Note that the latter condition is purely graph theoretical. 
\begin{theorem}
In the combinatorial interpretation of our topos we have that $A$ is interpreted as $\bigsqcup_{\text{tuples }(r_1\cdots r_n)} yU_{r_1\cdots r_n}\sqcup \{\text{Exotic atoms}\}$, the exponential is given by ... and ...% This really hinges upon the atoms as computed in this site
\end{theorem}
\begin{proposition} The internal language of our topos proves the negation of countable choice.
\end{proposition}
\begin{proof} We construct a countable product of non-empty objects, which is empty. Take $yU_{1/n}$ to be the representable functors of the finite probability space with two elements and measure $1/n$ on one of them. Then the multi-limit of this family is empty as there is no finite probability space with a sequence of elements $x_n$ with measures $1/n$. We conclude $\prod_n yU_{1/n}=0$.
\end{proof}

This proof can, in fact be adapted in many situations, to suggest that most countable products of objects are empty. So there is really not much hope to extend the transfer principle to statements containing countably infinitely many variables or more.
\begin{remark} All this is not too exotic, so in practice one may just pretend to work formally in ZFA as one usually pretends to do so in ZFC. The only thing one has to be vary of is the failure of the axiom of choice. But as the proof of the last proposition suggests, the failure of the axiom of choice can be strictly controlled using fairly straight forward multi-product calculations.
\end{remark}
\section{Forgetting how to measure}
In the case of "bare" boolean algebras, in particular, atomless ones, there is a well-known, classical model theoretic theorem. It has some less classical consequences which mirror quite closely what we have done above.
\begin{theorem} The first-order theory of atomless, decidable boolean algebras is complete. Moreover, the atomic topos on the site  $FinSur$ given by non-empty finite sets and surjections is its classifying topos and that is Morita equivalent to the automorphism group of boolean algebras of the Cantor space $\mathfrak{C}$ fixing finite partitions.
\[ \text{Sh}(FinSur, J_{at})\simeq \text{Cont}(Aut_{Bool}(\mathfrak{C}))\]
Its universal model is given by $h_2\sqcup h_1 \sqcup h_1$ i.e. the functor assigning each set its power-set algebra.
\end{theorem}
\begin{proof}Elephant, Olivia
\end{proof}
\begin{remark} Instead of $\mathfrak{C}$ one could take the boolean algebra $I$, again with the automorphism group fixing finite partitions. This follows from the argument given in Olivia.
\end{remark}
\begin{lemma} The evident forgetful functor $U: FinProb\rightarrow FinSur$ is a comorphism of sites. The corresponding geometric morphism 
\[U^*\dashv U_*: \text{Sh}(FinProb, J_{at})\rightarrow  \text{Sh}(FinSur, J_{at})\]
 is surjective and localic. We also get on representable functors:
 \[U^*h_X=\bigsqcup_{\mu\text{ is a measure on }X}h_{(X,\mu)}\]
\end{lemma}
\begin{proof} We need to show the covering-lifting property. It is enough to check this on sieves with one morphism as the atomic topology is generated by them. Given any finite probability space $(X,\mu)$ and cover $\{f: Y\rightarrow U(X,\mu) \}$, we can equip $Y$ with a measure $\nu$ making $\{f: (Y,\nu)\rightarrow (X,\mu) \}$ measure preserving. Define:
\[\nu(y)=\frac{\mu(f(y))}{\# f^{-1}(f(y))} \]
This is a measure as $\nu(y)>0$ and
\[  \sum_{y\in Y}\nu(y)=\sum_{y\in Y}\frac{\mu(f(y))}{\# f^{-1}(f(y))}=\sum_{x\in X}\sum_{y\in f^{-1}(x)}\frac{\mu(f(y))}{\# f^{-1}(f(y))} =\sum_{x\in X}\mu(x)=1\]
where the penultimate step holds as $f$ is surjective. This line of reasoning also shows that $f$ is measure preserving. 
\newline \indent To show it is surjective, it suffices to show $U^*$, which is the composition of sheafification and precomposition by $U$, is faithful. Sheafification is always faithful, so we need only check $-\circ U$ is. As $U$ is essentially surjective on objects we can apply the argument of A4.2.7(b) to see this.
\newline \indent It is localic as $U$ is faithful and both topologies are subcanonical, so the argument of A4.6.2(c) applies.
\newline\indent The explicit equation follows by the following observation, probing both functors at some finite probability space $(Y,\nu)$:
\[U^*h_X(Y,\nu)=FinSur(Y,X)=\bigsqcup_{\mu\text{ is a measure on }X}FinProb((Y,\nu),(X,\mu))\]
This holds as any surjective map $f:Y\rightarrow X$ induces a unique measure $\mu(x)=\sum_{y\in f^{-1}(x)} \nu(y)$ on $X$ making $f$ measure preserving. On maps $f:X\rightarrow Y$, we get for the representable functors:
\begin{center}
\begin{tikzcd}
{U^*h_X(Z,\lambda)} \arrow[d, "{U^*h_f(Z,\lambda)}"'] \arrow[r, dash] & {FinSur(Z,X)} \arrow[d, "f\circ -" description]\arrow[r, dash]  & {\bigsqcup_{\mu}FinProb((Z,\lambda),(X,\mu))} \arrow[d, "\alpha_f (Z{,} \lambda)"] \\
{U^*h_Y(Z,\lambda)} \arrow[r, dash]                                   & {FinSur(Z,Y)}\arrow[r, dash]                    & {\bigsqcup_\nu FinProb((Z,\lambda),(Y,\nu))}                     
\end{tikzcd}
\end{center}
There is at most one non-empty $FinProb((Z,\lambda),(X,\mu))$ respectively \linebreak $FinProb((Z,\lambda),(Y,\mu))$. And $\nu(y)=\sum_{x\in f^{-1}(y)} \mu(x)$ for all $y\in Y$, so  $\alpha_f (Z{,} \lambda)$ is simply post composition between these hom-sets.
\end{proof}%Is there a "two out of three rule for surjectivity in general?"
The fact that it is localic hints to the fact that the theory which "our topos" classifies is obtained from the theory of atomic boolean algebras by adding only relation symbols and axioms. [ref olivias denseness paper]
\begin{corollary} The geometric morphism $(U^*\vdash U_*)$ corresponds to the map exhibiting the universal model of the theory of continuum boolean probability algebras as an atomic boolean algebra. The inequality predicate is $\bigvee_{r>0} B_r ( A\Delta B )$.%edited this here!
\end{corollary}
\begin{proof} We compute 
\[U^*(h_2\sqcup h_1 \sqcup h_1)= (U^*h_2)\sqcup (U^*h_1)\sqcup (U^*h_1)=\bigsqcup_{r\in (0,1)}h_{(2,r)}\sqcup h_1 \sqcup h_1, \] which is the universal model of the theory of continuum boolean probability algebras. It is easily checked that this identification induces an isomorphism of the boolean algebra structures.
\end{proof}%Super technical detail allert!!!!!!! r=0, r=1 !!!!!!!! a single point missing !!!!!!!!!!!!!
We can also characterise the internal complete boolean algebra, the sheaves over which are equivalent to our topos.
\begin{lemma} Given the sheaf of boolean algebras $\mathbb{M}$ which assigns to a finite sets the power set of the set of probability measures on it and a set map $f:X\rightarrow Y$ to the map given by $\{\nu \}\mapsto \{\mu| \forall y\in Y. \nu(y)=\sum_{x\in f^{-1}(y)}\mu(y)  \}$. Then we get:
\[\text{Sh}(FinProb,J_{at})\simeq \text{Sh}_{\text{Sh}(FinSur,J_{at})}(\mathbb{M}) \]
\end{lemma}
\begin{proof} By [elephant], we need to compute $U_*\Omega$ for the subobject classifyer $\Omega$:
\[(U_*\Omega)(X)\simeq \text{Hom}(h_X,U_*\Omega)\simeq \text{Hom}(U^*h_X,\Omega)\simeq \text{Hom}(\bigsqcup_{\mu \text{ is a measure on }X}h_{(X,\mu)},\Omega)\]
\[\simeq \prod_{\mu \text{ is a measure on }X}\text{Hom}(h_{X,\mu},\Omega)\simeq \prod_{\mu \text{ is a measure on }X} 2\simeq 2^{\{\mu \text{ is a measure on }X\} } 
 \]
 Here we used, that the representable functors are atoms and the $\Omega$-axiom.
 On maps, a similar calculation can be done to compute $(U_*\Omega)(f)$ for $f:X\rightarrow Y$:
 \begin{center}
 \begin{tikzcd}
{\text{Hom}(U^*h_Y,\Omega)} \arrow[d, "-\circ U^*h_f"'] \arrow[r,dash] & {\text{Hom}(\bigsqcup_\nu h_{(Y,\nu)},\Omega)} \arrow[d, "-\circ \alpha_f" description] \arrow[r,dash]  & {\text{Sub}(\bigsqcup_\nu h_{(Y,\nu)})} \arrow[d, "\text{pull back along }\alpha_f"] \\
{\text{Hom}(U^*h_X,\Omega)} \arrow[r,dash]                                        & {\text{Hom}(\bigsqcup_{\mu} h_{(X,\mu)},\Omega)}          \arrow[r,dash]                                & {\text{Sub}(\bigsqcup_\mu h_{(X,\mu)})}                                             
\end{tikzcd}
\end{center}
Pulling back $\alpha_f$ is given by sending $\{\nu\}$ to the set of all possible measures $\mu$ on $X$ whose pushforward measure is $\nu$.  
\end{proof} 
This construction looks strikingly similar to the distribution (or finitary Giry) monad used in other category theoretic investigations of probability.[quote some paper] We can recover $\mathbb{M}$ as the following composite:
\begin{center}
\begin{tikzcd}
\mathbb{M}: FinSur^{op}\arrow[r, "D^{op}"]& \text{Set}^{op}\arrow[r,"\mathcal{P}"]&\text{Set}\\
\end{tikzcd}
\end{center}
Here $D$ is the restriction of the distribution monad and $\mathcal{P}$ the contravariant power set functor.
\begin{lemma} The geometric morphism considered above is naturally isomorphic to the one given by:
\[\tilde{U}^*\dashv \tilde{U}_*:\text{Cont}(Aut_{BProbAlg}(I,\lambda))\rightarrow\text{Cont}(Aut_{Bool}(I))\]
where the inverse image functor is defined as restricting the action of $Aut_{Bool}(I)$ to the one of $Aut_{BProbAlg}(I,\lambda)$.
\end{lemma}
\begin{proof} 
$\tilde{U}^*$ preserves colimits as colimits of sets with continuous group actions are computed using the underlying sets only (in partiuclar $\tilde{U}_*$ exists).
Now we can apply the coYoneda lemma, it suffices to show $U^*$ does the right stuff on representables.
  $\tilde{U}^*\text{Hom}_{Bool}(X,I)$ is the set 
$\text{Hom}_{Bool}(X,I)$ with the action given by $Aut_{BProbAlg}(I,\lambda))$. Here we compute:
\[\text{Hom}_{Bool}(X,I)=\bigsqcup_{\mu\text{ is measure on }X}\text{Hom}_{BProbAlg}((X,\mu),(I,\lambda))\]
This holds as for any boolean algebra homomorphism $f:X\rightarrow I$, we can induce a unique measure $\mu_f$ on $X$ making it measure preserving. The stuff on the right hand side is as we expected, concluding the proof.
\end{proof}
\begin{remark} The same argument would apply for any homogeneous measure algebra instead of $I$.
\end{remark}
\section{Advanced, general tools}
%Before we can begin providing a connection between the different categories of sheaves over the underlying boolean algebras of Set-based probability intervals, we will require a crucial measure theoretic lemma.
%\begin{lemma} Given a measure algebra $(\mathcal{B},\mu)$ with $\mu(\top)=1$ (here we assume that the measure is additive) then any measure preserving automorphism of boolean algebras $f:(\mathcal{B},\mu)\rightarrow (\mathcal{B},\mu)$ preserves all meets and joins.
%\end{lemma}
%\begin{proof} Because in the reference \cite{fremlin}, they use many definitions and theorems, that the reader may not be familiar with, we choose to sketch the proof of 324Kb from which our claim immediately follows.\newline
%\indent First note that a morphism of boolean algebra between complete boolean algebras preserves all meets and joins iff it preserves meets of the form $\bigwedge_i A_i=\bot$ for decreasing $A_i$. This can be seen as follows:\newline 
%\indent  Given arbitrary $A_i$ prove preservation of $\inf A_i$ using that for any ordering $<$ of the index set $I$ we get
%\[\bigwedge_{i\in I} \bigwedge_{j<i} (A_j \Delta \inf A_i)=\bot\] %Do we need this much detail?
%\indent Given $\sup A_i$ use $\sup A_i=\neg \inf \neg A_i$\newline
%$\mu$ is additive hence for decreasing $A_i$ we have $\bigwedge_i A_i=\bot$ iff $\inf \mu(A_i)=0$. Now the measure preservation comes in:
%\[ \inf \mu f(A_i)=\inf \mu(A_i)=0\]
%Hence $f$ is necessarily a complete boolean algebra homomorphism.
%\end{proof}
\begin{lemma} The universal model $U$ of the theory of probability intervals is $(M,\alpha)$ acting on itself via its automorphisms when interpreted as a set with continuous group action by the group of automorphisms of a Maharam-type-homogeneous probability algebra $(M,\alpha)$ as in \ref{Galois}. Moreover, it is an internal complete boolean algebra.
\end{lemma}
\begin{proof} 
%We apply the bridge $\text{Cont}(\text{Aut}_{BPAlg}(I,\lambda))\simeq \text{Sh}(FinProb^{op},J_{at})$. Recall that this is given as the Lan extension of the functor 
%\[F:FinProb^{op}\rightarrow \text{Cont}(\text{Aut}_{BPAlg}(I,\lambda))\]
% sending $(B,\mu)$ to $\text{Hom}_{BProbAlg}((B,\mu),(I,\lambda))$ with action by post composition and sending maps to their pre-compositions. Under this equivalence, the universal model gets sent to:
%\[\bigsqcup_{r\in [0,1]} \text{Hom}_{BPAlg}(U_r, (I,\lambda))\simeq I \]
%The isomorphism $\chi$ is given by sending $f\in \text{Hom}_{BPAlg}(U_r, (I,\lambda))$ to the image of the element with measure $r$ in $(I,\lambda)$. We need to check that the boolean algebra structure of the universal model coincides with the one of $I$. But this can be done exactly as in the proof of [classifying shit]. We already know that the following diagram commutes:
%\begin{center}
%\begin{tikzcd}[column sep=small]
%      & {(b_1,b_2,b_3,b_4)} \arrow[r, maps to]                                                  & {(b_1\vee b_2,b_1\vee b_3)}                                 \\
%{(b_1,b_2,b_3,b_4)} \arrow[d, maps to] & \bigsqcup yU_{r_1\cdots r_4} \arrow[d, "\bigsqcup (p_1)_*"'] \arrow[r, "\alpha_1^{-1}"] & (\bigsqcup yU_r)\times (\bigsqcup yU_s) \arrow[d, "\wedge"] \\
%{(b_1,b_2\vee b_3\vee b_4)}            & \bigsqcup yU_r \arrow[r]                                                                & \bigsqcup yU_r                                             
%\end{tikzcd}
%\end{center}
%Now we apply our equivalence of categories and it remains to check that the following diagram commutes. This can be done on underlying sets. The underlying set of $I\times I$ as computed in $\text{Cont}_{\tau}(\text{Aut}_{BPalg})$ is also $I\times I$ as forgetting the group action is the inverse image of a geometric morphism.
%\begin{center}
%\begin{tikzcd}
%{\bigsqcup \text{Hom}(U_{r_1\cdots r_4},I)} \arrow[d, "\bigsqcup Lan_F(p_1)_*"'] \arrow[rrr, %"Lan_F(\alpha_1^{-1})\circ(\chi\times\chi)"] &  &  & I\times I \arrow[d, "\wedge"] \\
%{\bigsqcup \text{Hom}(U_r,I)} \arrow[rrr, "\chi"']                                                                                        &  &  & I                            
%\end{tikzcd}
%\end{center}
%Take an element $f:U_{r_1\cdots r_4}\rightarrow I$ in the top left corner, call the images of the elements in $I$ $x_1\cdots x_4$. We need to compute $Lan_F(\alpha_1)(f)$. % The Lan extension of $(p_1)_*\circ\alpha_1$ is given by precomposing with $\wedge$. Understand this!
%$\alpha^{-1}_1$ is induced by the universal property of the product and then coproduct, so its Lan extension is easier to compute: $\alpha^{-1}_1=\bigsqcup \beta_{r_1\cdots r_4}\times \bigsqcup \gamma_{r_1\cdots r_4}$ for
%\[\beta_{r_1\cdots r_4}:yU_{r_1\cdots r_4}\rightarrow \bigsqcup yU_r, \, \gamma_{r_1\cdots r_4}:yU_{r_1\cdots r_4}\rightarrow \bigsqcup yU_s\]
%$\beta_{r_1\cdots r_4}$ factors over the inclusion $yU_{r_1+r_2}\rightarrow \bigsqcup yU_r$ and $\gamma_{r_1\cdots r_4}$ factors over $yU_{r_1+r_3}\rightarrow \bigsqcup yU_s$ . For this, by the Yoneda lemma, the map $\beta_{r_1\cdots r_4}$ comes from the map $b_{r_1\cdots r_4}:U_{r_1\cdots r_4}\rightarrow U_{r_1+r_2}$ of finite probability spaces sending the first two element of the left hand side to the first on the right hand side. Analogously we get $\gamma_{r_1\cdots r_4}=yc_{r_1\cdots r_4}$. This can finally be Lan extended easily: (Note our abusive notation. We identify the finite probability spaces with their corresponding finite probability algebras, so the morphisms of finite probability algebras point in the other direction)
%\begin{center}
%\begin{tikzcd}
%{\text{Hom}(U_{r_1+r_2},I)} \arrow[rrd]                                                                                                            &  &                                                              \\
%{ \text{Hom}(U_{r_1\cdots r_4},I)} \arrow[rr, "Lan_F(\alpha_1^{-1})"] \arrow[d, "-\circ c_{r_1\cdots r_4}"'] \arrow[u, "-\circ b_{r_1\cdots r_4}"] &  & {\text{Hom}(U_{r_1+ r_2},I)\times \text{Hom}(U_{r_1+r_3},I)} \\
%{\text{Hom}(U_{r_1+r_3},I)} \arrow[rru]                                                                                                            &  &                                                             
%\end{tikzcd}
%\end{center}
%We compute $Lan_F(\alpha^{-1}_1)(f)=(f\circ b_{r_1\cdots r_4}, f\circ c_{r_1\cdots r_4})$. One easily computes that $(\chi\times \chi)(f\circ b_{r_1\cdots r_4}, f\circ c_{r_1\cdots r_4})=(x_1\vee x_2, x_1\vee x_3)$ and $\wedge (x_1\vee x_2, x_1\vee x_3) = x_1$.\newline
%\indent Likewise, $(p_1)_*$ factors over $\rho_{r_1\cdots r_4}:yU_{r_1\cdots r_4}\rightarrow yU_{r_1}$ and this is the Yoneda embedding of $p_{r_1\cdots r_4}$. Thus $Lan_F((p_1)_*)(f)=f\circ p_{r_1\cdots r_4}$ and one can easily see that $\chi(f\circ p_{r_1\cdots r_4})=x_1$. This concludes the proof. As the poset structure can be recovered from this via $a\leq b\iff a\wedge b=a$, this shows $Lan_y(U)$ and $I$ have the same poset structure. As all the other operators can be induces as limits and colimits in Set, the boolean algebras are isomorphic.
We can use Theorem 7.3 (and remark 7.2) \cite{caramello_lafforgue} %is this the correct ref?
 to see $(M,\alpha)$ is a special model of $\mathbb{T}_{int}$ and thus the universal model in $\text{Cont}_\tau(\text{Aut}(M,\alpha))$ is $(M,\alpha)$ with the canonical continuous group action.\newline 
\indent Thus $U$ is a complete boolean algebra acting on itself via automorphisms.  As isomorphisms of lattices preserve all meets and joints, these are even automorphisms of complete boolean algebras, in particular locales. Locales in $\text{Set}^G$ are simply locales upon which $G$ acts by locale-automorphisms by C2.5.8(d) so the universal model is a  $[\text{Aut}(I,\lambda),\text{Set}]$-indexed locale. B2.3.10 states that, for any closure operator $j$ on a topos $\mathcal{S}$ an $\mathcal{S}$-indexed cocomplete category is a  $sh_j\mathcal{S}$-indexed cocomplete category iff it is a $j$-sheaf. Applying this result to the closure operator associated to the inclusion
\[\text{Cont}_\tau(\text{Aut}(I,\lambda))\hookrightarrow [\text{Aut}(I,\lambda),\text{Set}]\]
 proves that the universal model is internally cocomplete. Hence it is a complete boolean algebra (cocompleteness implies completeness and conversely).
\end{proof}
This result is highly unexpected. Fixing only finitary data, we have forced the maps to preserve some infinitary structure! Note that this is also possible in the situation of the theory of atomless boolean algebras. We can nicely exploit this using the following lemma, which will relate all this to the category of sheaves over homogeneous Maharam-type measure algebras.
\begin{lemma}[Trivial lemma on iterated forcing] Given a complete boolean algebra $\mathcal{B}$, a group $G\subseteq \text{Aut}(\mathcal{B})$ of complete boolean algebra automorphisms of $\mathcal{B}$ and a topology $\tau$ on $G$ such that the canonical action $G\curvearrowright \mathcal{B}$ is $\tau$-continuous.\footnote{More generally, one could take any group $G$ and topology $\tau$ with a $\tau$-continuous action $G\curvearrowright \mathcal{B}$ by boolean algebra automorphisms.} Then we get a 2-pullback diagram in the 2-category of topoi, geometric morphisms and natural transformations:
\begin{center}
\begin{tikzcd}
\text{Sh}(\mathcal{B}) \arrow[d, "\bar{f}"'] \arrow[r, "\Gamma"]      & \text{Set} \arrow[d, "f"] \\
{\text{Sh}^{(G,\tau)}(\mathcal{B})} \arrow[r, "{\Gamma^{(G,\tau)}}"'] & \text{Cont}_\tau(G)      
\end{tikzcd}
\end{center}
Here $\text{Sh}^{(G,\tau)}(\mathcal{B})$ denotes the topos of $(G,\tau)$-equivariant sheaves on $\mathcal{B}$ and $f^*$, $\bar{f}^*$ just forget the group action.\newline
\indent In particular, $\bar{f}$ is an open surjective geometric morphism.
\end{lemma}
\begin{proof} To see that this is a pullback, note that $\Gamma^{(G,\tau)}$ is a localic geometric morphism and pullbacks of such morphisms are again localic. Denote by $(\mathcal{E},e,\Gamma)$ some choice of pullback of the square commuting up to natural iso $\eta$. Then it is determined by $\Gamma \Omega_\mathcal{E}$ which is a locale. We know $f$ is open geometric as points of atomic toposes are always open surjective by C3.5.6. By C3.1.28 $f$ is a left Beck-Chevalley morphism, hence we compute, denoting the subobject classifier of $\text{Sh}^{(G,\tau)}(\mathcal{B})$ by $\Omega$:
\[ \mathcal{B}=f^*\Gamma^{(G,\tau)}\Omega\simeq \Gamma e^*\Omega\simeq \Gamma e^*(1\sqcup 1)\simeq \Gamma (1\sqcup 1)\simeq\Gamma \Omega_\mathcal{E}  \]
\newline
In the first step we use the well-known description of subobject classifiers of localic topoi [ref]. In the second steps we use that for boolean topoi we have $(\top,\bot):1\sqcup 1\simeq \Omega$. That the boolean algebra structure is preserved  by the Beck-Chevalley morphism is immediate as all functors in question preserve finite limits and thus the algebraic structure of boolean algebras. It remains to check whether the boolean algebra structure of $ e^*\Omega$ coincides with the one of $ \Omega_\mathcal{E}$. Recall that this is induced by the $\Omega$-axiom using the characteristic arrows of various subobjects defined by pullbacks [do we need diagrams?]. $e^*$ preserves the subobject classifier, the inclusions $\top:1\rightarrow \Omega$ as well as pullbacks, the terminal object and injectivity of morphisms. Thus 
\begin{center}
\begin{tikzcd}
e^*S \arrow[r] \arrow[d, hook] & 1=e^*1 \arrow[d, "\top=i_1=e^* i_1=e^*\top"]              \\
e^*X \arrow[r, "\chi_{e^*S}"']      & \Omega=1\sqcup 1=e^*(1\sqcup 1)=e^*\Omega
\end{tikzcd}
\end{center}
\indent is a pullback if the following is:
\begin{center}
\begin{tikzcd}
S \arrow[r] \arrow[d, hook] & 1 \arrow[d, "\top"] \\
X \arrow[r, "\chi_S"']      & \Omega             
\end{tikzcd}
\end{center}
Hence by the uniqueness condition of the $\Omega$-axiom, $e^*\chi_S=\chi_{e^*S}$. In particular, all the structure defined in this way gets preserved. This proves that the square is indeed a 2-pullback.

\indent Pullbacks of open surjections are again open surjections by C3.1.23, thus $\bar{f}$ has this property. 
\end{proof}


\begin{theorem}[Very strong completeness] Given a probability algebra $(M,\alpha)$ of homogeneous-Maharam-type with classifying morphism as a model of the theory of probability intervals $f_{(M,\alpha)}:\text{Set}\rightarrow \text{Set}[\mathbb{T}_{int}]$, we get the following 2-pullback diagram of topoi and geometric morphisms:
\begin{center}
\begin{tikzcd}
\text{Sh}(M) \arrow[r, "\Gamma"] \arrow[d, "\bar{f}"']   & \text{Set} \arrow[d, "{f_{(M,\alpha)}}"] \\
{\text{Sh}_{\text{Set}[\mathbb{T}_{int}]}(U)} \arrow[r, "\Gamma^{(G,\tau)}"'] & {\text{Set}[\mathbb{T}_{int}]}                 
\end{tikzcd}
\end{center}
Impressively, $\bar{f}$ is an open surjective geometric morphism. It preserves and reflects infinitary first order logic.
\end{theorem}
\begin{proof} 
Follows immediately from the last two theorems and the bridge 
\[\text{Cont}_\tau(\text{Aut}_{BPRobAlg}(M,\alpha))\simeq \text{Set}[\mathbb{T}_{int}]\]
 for homogeneous Maharam-type measure algebras under which, as shown in these lemmas, the universal model corresponds to $\mathcal{B}$.%is this the correct wording?
\end{proof}
The following might be rather boring as descent for torsors is just giving a "global trivialisation"!
\begin{corollary}[Descent] The morphism $\bar{f}$ has descent. This means $\mathcal{F}:=\text{Sh}_{\text{Set}[\mathbb{T}_{int}]}(U)$ is equivalent to the category of the descent data.
Fixing the notation as in the following diagram:
\begin{center}
\begin{tikzcd}
{\text{Sh}(M)\times_\mathcal{F}\text{Sh}(M)\times_\mathcal{F}\text{Sh}(M)} \arrow[r, "\pi_{13}" description] \arrow[r, "\pi_{12}", shift left=3] \arrow[r, "\pi_{23}"', shift right=3]  & {\text{Sh}(M)\times_\mathcal{F}\text{Sh}(M)} \arrow[r, "\pi_2"', shift right=3] \arrow[r, "\pi_1", shift left=3] & {\text{Sh}(M)} \arrow[l, "\Delta" description]
\end{tikzcd}
\end{center}
The category of descent data is defined by tuples $(A,\theta)$ where $A$ is a sheaf on $M$ and $\theta:\pi_1^*A\simeq \pi_2^*A$ is an isomorphism such that $\Delta^*\theta=\text{id}$ and the cocycle condition $\pi_{13}^*\theta=\pi_{12}^*\theta\circ \pi_{23}^*\theta$ is fulfilled. Morphisms of descent data are natural transformations $\psi:A\rightarrow B$ commuting with all the structure.
\end{corollary}
\begin{proof} Open surjections are descent morphisms by C5.1.6.
\end{proof}
As before, to make this theory workable, we need a lot of different, insightful site presentations. There are two given in [elephant] first continuous equivariant sheaves A2.1.11(c)%is this a thing? Also C5.4.6
, secondly an explicit site given in C2.5.8(e). We quote:\newline
\indent For an open subgroup $U\subseteq G$, define $I_U$ as the subset of $I$ invariant under the action of $U$. We obtain a site $(\mathcal{I},J)$ with $\mathcal{I}$ the category with objects pairs $(U,x)$ of open subgroups $U$ and $x\in I_U$ and morphisms $(U,x)\rightarrow (V,y)$ labelled by cosets $gV$ of $V$ such that $U\subseteq gVg^{-1}$ and $x\leq g(y)$ in $I$.  A sieve $R$ on $(V,y)$ is $J$-covering if $y$ is the join of all those $x$ for which there exists $U$ such that $x\in I_U$ and $V:(U,x)\rightarrow (V,y)\in R$. This site is nice as the projection to the subgroups is cover-reflecting and induces the functor $\Gamma^{(G,\tau)}$ as in the theorem as they note.
\begin{lemma}\label{Rand_site} $\mathfrak{Rand}$ is equivalent to the category of sheaves over the following site: $(FinProb\rtimes U ,J_{at}\rtimes J_{can})$ where the category $FinProb\rtimes U$ is the category with objects pairs $(X,\mu,x)$, where $(X,\mu)$ is a finite probability space and $x\in \mathcal{P}(X)$, and morphisms $f_{\leq}:(X,\mu, x)\rightarrow (Y,\nu, y)$ are measurable functions $f:(X,\mu)\rightarrow (Y,\nu)$ such that $f(x)\subseteq y$. A sieve $R$ on $(Y,\nu, y)$ is $J_{at}\rtimes J_{can}$-covering if $y$ is the union of all those $f(x)$ such that there exists a $f_{\leq}:(X,\mu,x)\rightarrow (Y,\nu,y)\in R$. In particular the single morphism $f_{\leq}:(X,\mu,f^{-1}(y))\rightarrow (Y,\nu,y)$ is covering for any measure-preserving  function $f$ and the map $FinProb\rtimes U\rightarrow FinProb$ is cover-reflecting.

\end{lemma}
\begin{proof}
One just computes the Grothendieck construction "$\rtimes$" for the indexed category $U$ over $FinProb$ as explained in C2.5.4. We use that $U(X,\mu)=\mathcal{P}(X)$ and $U(f):U(Y,\nu)\rightarrow U(X,\mu)$ is given by $f^{-1}:\mathcal{P}(Y)\rightarrow \mathcal{P}(X)$.\footnote{This had been remarked earlier and is fairly obvious. We might actually want to prove it explicitly anyway though.} Thus $FinProb\rtimes U$ has as objects as described in the lemma and as morphisms pairs $(f,\leq)$ where $f:(X,\mu, x)\rightarrow (Y,\nu, y)$ and $\leq: x\rightarrow f^{-1}(y)$ in $\mathcal{P}(X)$ this is equivalent to $f(x)\subseteq y$ in $\mathcal{P}(Y)$. Now we use the same line of argument as in C2.5.8(e). Evidently, any morphism in $FinProb\rtimes U$ can be factored as follows:
\begin{center}
\begin{tikzcd}
(X,\mu,x)\arrow[r, "id_{\leq}"]\arrow[rr,"f_{\leq}", bend right]& (X,\mu, f^{-1}(y))\arrow[r,"\overline{f_{\leq}}"]& (Y,\nu,y) \\
\end{tikzcd}
\end{center} 
$\overline{f_{\leq}}$ is covering as it consists of a $J_{at}$-cover $f:(X,\mu)\rightarrow (Y,\nu)$ and an isomorphism in $\mathcal{P}(X)$ [Is this an argument?]. Thus we may define [insert formal argument!] a sieve $R$ on $(Y,\nu,y)$ to be $J_{at}\rtimes J_{can}$-covering if $y$ is the union of all those $f(x)$ such that there exists a $f_{\leq}:(X,\mu,x)\rightarrow (Y,\nu,y)\in R$.
\end{proof}
This proof is super sketchy, which is especially bad as I don't formally understand what is going on. I'm going to have to revisit that. Assuming this holds true, we can also give a very nice condition when a presheaf is a sheaf for this topology:
\begin{lemma}\label{Rand_combinatorics} A presheaf $F:(FinProb\rtimes U)^{op}\rightarrow \text{Set}$ is a $J_{at}\rtimes J_{can}$-sheaf iff:
\begin{enumerate}
\item For any $(X,\mu,x)$ such that $x=\{x_1,\cdots, x_n \}$ we have:
\[F(X,\mu,x)\simeq \prod_{i=1}^n F(X,\mu,\{x_ i \})   \]
via the the product of the restriction maps.
\item For any measure preserving map $f:(X,\mu)\rightarrow (Y,\nu)$, element $y\in Y$ and element $a\in F(X,\mu, f^{-1}(\{y\}))$, if for all forks of measurable functions
\begin{center}
\begin{tikzcd}
{(Z,\lambda)} \arrow[r, "g", shift left] \arrow[r, "h"', shift right] & {(X,\mu)} \arrow[r, "f"] & {(Y,\nu),}
\end{tikzcd}
\end{center}
interpreting these maps as $f_{\leq}:(X,\mu,f^{-1}(\{y\}))\rightarrow (Y,\nu,\{y\})$, $g_{\leq}:(Z,\lambda, (f\circ g)^{-1}(\{ y\} ))\rightarrow (X,\mu, f^{-1}(\{ y \}))$ resp. $h_{\leq}:(Z,\lambda, (f\circ g)^{-1}(\{ y\} ))\rightarrow (X,\mu, f^{-1}(\{ y \}))$, we have $F(g_{\leq})(a)=F(h_{\leq})(a)$ then this implies $a=F(f_{\leq})(b)$ for some $b\in F(Y,\nu, \{y\})$.
\item[(ii)'] Equivalent to (ii) is that for any map of finite probability spaces $f:U_{r_i}\rightarrow U_{s_j}$ and element $y\in U_{s_j}$ we have an equalizer diagram, with notation as in \ref{sheaf_condition}:
\begin{center}
\begin{tikzcd}F(U_{s_j},\{ y\}	)\arrow[r,"Ff_\leq"]& F(U_{r_i},f^{-1}\{y\})\arrow[r, shift left, "F(p_{1,\leq})"]\arrow[r, shift right, "F(p_{2,\leq})", swap] & \prod_{t_{ij}}F(U_{t_{ij}},(f\circ p_1)^{-1}\{y \})
\end{tikzcd}
\end{center}
\end{enumerate}
\end{lemma}
\begin{proof} Any sheaf has this properties. (i) is just how the canonical topology is defined and (ii) follows from III4 Lemma 2 of [MacLaneMoerdijk]. This is not that hard to show.
\end{proof}
%To make sure that this abstract nonsense is correct or, at least, all the errors within suitably "cancel out" we shall compute the subobject classifier of $\mathfrak{Rand}$ using the description in \ref{Rand_site}.
%\begin{example} The global sections of the subobject classifier $\Omega$ of $\mathfrak{Rand}$ is given by $J_{at}\rtimes J_{can}$-closed sieves on %$(\{\star\}, 1, \{\star\} )$ (the probability space with one object equipped with itself as a subset), which is the terminal object of $FinProb\rtimes U$.
%finite probability spaces equipped with subsets.  Given $(X,\mu, x)$ we seek to calculate this set of sieves. The covering sieves are precisely sieves of morphisms $\{f_i: (Y_i,\nu_i,y_i)\rightarrow (X,\mu,x)\}$ such that $\bigcup_i f_i(y_i)=x$.
%\end{example}

\section{Appendix: Models in Set}

In this section, we show that the $Set$-based models of $Sh(FinProb, J_{at})$ are precisely certain infinite boolean probability algebras(in the sense defined below). This will be useful for the reader that is uninterested in seeing the general result about models in an arbitrary topos proved, since the proof here is easier to understand.


The models we want to compute are given by the $J_{at}$-flat functors\linebreak
 $Flat_{J_{at}}(FinProb, Set)$, so first we will use 
\[
Flat(FinProb, Set) \simeq Ind(FinProb^{op})
\]
to show that the flat functors consist precisely of the boolean probability algebras.

\begin{definition}
\begin{enumerate}
\item Let $B$ be a boolean algebra. We say a map $\mu: B \to \mathbb{R}_{\geq 0}$ is a measure if for elements $a,b \in B$, the following holds:
\begin{itemize}
\item $\mu(a) = 0$ if and only if $a = 0 $,
\item $\mu(a) + \mu(b) = \mu(a \vee b) + \mu(a \wedge b)$.
\end{itemize}
We will call a pair $(B, \mu)$ of a boolean measure and a measure a boolean measure algebra. If moreover $\mu(1) = 1$, we say that $\mu$ is a  probability measure and $(B,\mu)$ a boolean probability algebra.
\item We define a measure-preserving map $(B, \mu) \to (C, \nu)$ between boolean measure algebras to be a map of boolean algebras $f: B \to C$ satisfying
\[
\nu(f(x)) = \mu(x)
\]
for all $x \in B$. We will denote the category of boolean probability algebras with measure-preserving maps by $BPAlg$.
\item Denote the full subcategory of $BPAlg$ given by the finite boolean probability algebras by $BPAlg_f$.
\end{enumerate}
\end{definition}

% The reader will immediately notice that we are not considering any sort of $\sigma$-additivity. At first this will seem a bit unfamiliar, but by 416Qb in \cite{fremlin}, our measures on boolean algebras correspond precisely to Radon measures on the corresponding Stone space(without nontrivial sets of measure zero). This means that we should think about boolean probability algebras as a very special subset of the probability spaces traditionally considered in probability theory.  Whether this is to be interpreted as an indication of insufficiency of interesting probability theory is up to the readers judgement.

Note that we do not allow any nontrivial elements of measure zero. Moreover, the one-element boolean algebra cannot be made into a boolean probability algebra.

Before we get to prove anything interesting, we need to get the following out of the way:

\begin{proposition} We have an equivalence of categories
\[
FinProb^{op} \simeq BPAlg_f
\]
defined by sending a finite probability space $(X, \mu)$ to the finite boolean probability algebra $(\mathcal{P} X, \bar{\mu})$, where
\[
\bar{\mu}(S) := \sum_{x \in S} \mu(x).
\]
A map in $FinProb$ is sent to the preimage map on powersets.
\end{proposition}
\begin{proof}
See \ref{finprob_equiv}.
\end{proof}

From now on we will implicitly use this equivalence and use $FinProb$ or $BPAlg_f$ depending on which variance more convenient.
For computing the $Ind$-completion of $FinProb^{op} \simeq BPAlg_f$ , first notice that for Lawvere theories we have that the forgetful functor into $Set$ creates filtered colimits. This is a special case of theorem 5.6.5 ii) in \cite{riehl}, if one uses the well-known correspondence between finitary monads and Lawvere theories. Using this explicit description of the underlying set of a filtered colimit of boolean algebras, we can define filtered colimits in $BPAlg$:

\begin{theorem} 
If $(B_i, \mu_i)$ is a filtered diagram of boolean probability algebras and $B := colim_i B_i$ is the colimit of the underlying boolean algebras, we have that
\[
colim_i (B_i, \mu_i) \cong (B, \mu),
\]
where for $a \in B_i$, $\mu([a]) := \mu_i(a)$.
\end{theorem}
\begin{proof}
First note that $\mu$ is well-defined, because the maps in the diagram preserve the measure. Moreover, we can check the axioms of a measure WLOG for $a,b \in B_i$:
\begin{itemize}
\item $\mu([a]) = 0 \Leftrightarrow \mu_i(a) = 0 \Leftrightarrow a = 0$
\item $\mu(1) = \mu_i(1) = 1$
\item \begin{align*}
\mu([a] \vee [b]) + \mu([a] \wedge [b]) &= \mu([a \vee b]) + \mu([a \wedge b]) \\
&= \mu_i(a \vee b) + \mu_i(a \wedge b) \\
&= \mu_i(a) + \mu_i(b) \\
&= \mu([a]) + \mu([b])
\end{align*}
\end{itemize}
To see that this is actually a colimit, let $(C, \nu)$ be a boolean probability algebra and $f_i : (B_i, \mu_i) \to (C, \nu)$ be maps suitably commuting with the filtered diagram. We need to show that these maps factor through the inclusions into $(B, \mu)$ uniquely. First notice, that by looking at the underlying boolean algebras, we certainly get a unique map $\psi: B \to C$.  It only remains to show it is measure-preserving, so let $a \in B_i$.
\[
\nu(\psi [a]) = \nu(f_i a) = \nu_i(a) = \mu_i(a) = \mu([a]),
\]
so we have shown how to construct filtered colimits.
\end{proof}

Now we are ready to prove the following fact:

\begin{theorem} \label{ind} We have an equivalence of categories
\[
Ind(BPAlg_f) \simeq BPAlg
\]
given by sending a formal filtered colimit to the corresponding filtered colimit of boolean probability algebras.
\end{theorem}
\begin{proof}
Morphisms between two diagrams $F$, $G$ in $BPAlg_f$ in the $Ind$-completion are defined by
\[
lim_d colim_c BPAlg_f(F d, G c).
\]
In order to define the equivalence on morphisms, we would like to construct an isomorphism
\[
lim_d colim_c BPAlg_f(F d, G c) \cong BPAlg(colim F, colim G).
\]
We do this by showing compactness of the finite probability algebras. Let $(C, \mu)$ be a finite probability algebra and $(B_i, \mu_i)$ be a filtered diagram with colimit $(B, \mu)$. We want to show that the map
\[
\kappa: colim_i Hom((C, \nu), (B_i, \nu_i)) \to Hom((C,\nu), (B,\mu))
\]
is in fact a bijection.

To show it is injective, let $\kappa([f]) = \kappa([g])$ with WLOG $f,g \in Hom((C,\nu), (B_i, \nu_i))$. This means we have a fork
\[
\begin{tikzcd}
{(C,\nu)} \arrow[r, "f", shift left] \arrow[r, "g"', shift right] & {(B_i,\mu_i)} \arrow[r] & {(B,\mu)},
\end{tikzcd}
\]
which of course gives us a fork
\[
\begin{tikzcd}
C \arrow[r, "f", shift left] \arrow[r, "g"', shift right] & B_i \arrow[r] & B,
\end{tikzcd}
\]
which by compactness of $C$ implies that $[f] = [g]$ in $colim_i Hom(C,B_i)$ and thus also in $colim_i Hom((C,\nu), (B_i, \nu_i))$. This shows injectivity.

To prove surjectivity, let $f:(C, \nu) \to (B,\mu)$ be a map. By compactness of $C$, it factors through an inclusion:
\[
\begin{tikzcd}
{(C,\nu)} \arrow[r, "\hat{f}" description, dotted] \arrow[rd, "f"'] & {(B_i,\mu_i)} \arrow[d, "\iota_i"] \\
                                                                & {(B,\mu)}                         ,
\end{tikzcd}
\]
where in fact $\hat{f}$ is measure-preserving since $\mu_i(\hat{f} x) = \mu(\iota \hat{f} x) = \nu x$. This concludes the proof of surjectivity and thus we have proven that we have a fully faithful functor $Ind(BPAlg_f) \to BPAlg$.

In order to show this functor is essentially surjective on objects, we need to show that every boolean probability algebra is a filtered colimit of finite probability algebras. So let $(B, \mu)$ be a boolean probability algebra. Certainly, we can write the underlying boolean algebra as a filtered colimit of finite boolean algebras
\[
B \cong colim_i B_i.
\]
Then the inclusions $\iota_i: B_i \to B$ let us induce a measure $\mu_i$ on $B_i$ ($\mu_i(x) := \mu(\iota_i x)$). To show that this is a diagram in $BPAlg$, notice that for an arrow $f: i \to j$ in the indexing category, we get a commutative diagram
\[
\begin{tikzcd}
{(B_i,\mu_i)} \arrow[r, "B_f"] \arrow[rd, "\iota_i"'] & {(B_j,\mu_j)} \arrow[d, "\iota_j"] \\
                                                      & {(B,\mu)}                         ,
\end{tikzcd}
\]
where in fact, $B_f$ is measure-preserving since $\iota_i$ and $\iota_j$ are measure-preserving.

Now the colimit of the $(B_i, \mu_i)$ is in fact $(B, \mu)$ by the previous theorem. This concludes the proof.
\end{proof}

Before the reader reads the next proof, he is advised to read the remarks about boolean probability algebras in \ref{partitions}.

\begin{theorem} The category of points of the topos $\textbf{Sh}(FinProb,J_{at})$ is equivalent to the full subcategory of $BPAlg$ of boolean probability algebras $(B,\mu)$ such that for each $r\in (0,1)$ and each $b\in B$ there exist $b', b''\in B$ with $b'\vee b''=b$, $b'\wedge b''=0$ and $\mu(b')=r\mu(b)$.\end{theorem}
\begin{proof} The category of points is given by the category of $J_{at}$-flat functors $Flat_{J_{at}}(FinProb, Set)$.  The equivalence 
\[
Flat(BPAlg_f^{op}, Set) \simeq Ind(BPAlg_f) \simeq BPAlg
\]
shows that the flat functors are precisely the $BPAlg(-,(B,\nu))$ for a boolean probability algebra $(B,\nu)$. As the covering sieves consist of single morphisms, the $J_{at}$-flat functors will consist of the $BPAlg(-,(B,\nu))$ for which all maps in $BPAlg_f$ are sent to epimorphisms. This is equivalent to the existence of measure-preserving lifts:
\begin{center}
\begin{tikzcd}
{(A_1, \mu_1)} \arrow[r, "g"] \arrow[rd, "f"'] & {(A_2,\mu_2)} \arrow[d, "\bar{f}" description, dotted] \\
                                               & {(B,\nu)}                                 
\end{tikzcd}
\end{center}
for any $(A_1,\mu_1), (B_1,\mu_1)$ in $BPAlg_f$ and measure-preserving maps $f,g$. The atoms $a_i$ in $A_1$ give us a partition that gets preserved by $f$ and $g$. Thus we get decompositions (see \ref{partitions}) of $A_2$ and $B$ and our problem decomposes into finding measure-preserving lifts

\begin{center}
\begin{tikzcd}
2 \arrow[r] \arrow[rd] & I(g a_i) \arrow[d, "\bar{f}^i" description, dotted] \\
                                               & I(f a_i)
\end{tikzcd}.
\end{center}
But $2 := \{0, 1\}$ can be ignored. Furthermore, $I(g a_i)$ is finite, so by $\ref{partitions}$, such a map $\bar{f}^i$ is precisely a partition $x_1, \cdots, x_m$ of $B^i$ into a fixed number of elements that have a predetermined measure.

We can summarize our findings as follows: $BPAlg(-, (B,\nu))$ is $J_{at}$-flat if and only if every $x \in B$ and numbers $p_1, \cdots, p_m \in \mathbb{R}_{>0}$ such that $p_1 + \cdots + p_m = \nu(x)$, there exists a partition of $I(x)$ into elements $x_i$ of measure $p_i$. Of course, the binary case suffices and we get our claim.
\end{proof}


\begin{thebibliography}{9}
\bibitem{sheaves_geometry_logic} 
Saunders Mac Lane, Ieke Moerdijk. \textit{Sheaves in Geometry and Logic} A First Introduction to Topos Theory.
\bibitem{elephant}
ELEPHANT
\bibitem{caramello_book}
Theories, Sites, Toposes - Caramello
\bibitem{fremlin}
FREMLIN
\bibitem{riehl}
Category theory in context
\bibitem{caramello_lafforgue}
Some aspects of topological Galois theory
\end{thebibliography}

\section{Appendix: Illustrations}


\begin{landscape}
% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZAJgBoAGAXVJADcBDAGwFcYkQAxLMABQCcIAIwAUAWlLCAGqQA6MgLbMAlEpABfUuky58hFABYK1Ok1bsAQvyEBBRgHNhU2QuUSAks8b15gqPRXqmiAY2HgERAAcRjQMLGyIIHKCWHZwAI4AxsxoAPrAcopyODAAHjjAAARYcBX0FfIw9HDMfDAVBBVqkmpcvAIi4k4FyqoaWqG6ROSkAIzGsWYJRaXlAMoAFmrCBfQ46xlMwADCank7e4KCwAAqp8AZgmgCaGoaAFI55+uXN2qjQSEdOEUGQ5jFTPFEjJimVgBstr0rIJSB9gLs-oFxkC9MhDGCTHF2MtYUcCDg7kV6MwtsTytZmOS8pZ+rY7FsPHIvD4-AExsFtGEcQA2WbzCFE6ErOGbYSI-p5dEohXk-5YwWRUXgwlLSWw+FnXVrGW9VYtJVolU0hS7b5XAAyGL5gPVKGmAGYxdqoTCjVb5DaDoxjhTrRcrrdlRAfK8lV8frdVfyJsCSKQPVrFt6pfDZdxTXxzejE87JgY057M7TjmSQzgqVafcB6YzgOYIBBGOzeQCBaXkCL0wTK4bpQi8y1le9J8XeymooOFpCqzmTWbUUXMUnsUQyPoK5DV3wxKRJDPkzjDHuM5C2x2nG4z9uUFEr0OD+Oj+JT5uSynpgBWfcJUbABZaAYEYCo9hgCA+AATzUH9ZxxMhAOvYCpVJHxuF2WCsAyOBEKdZCiEMNC3ww2EAHEBGyWoMkFQikPPIgRXIxdKPKMDYEYGoIAAMwqAAtDhrCInsWOfUh2PFHVGzcMBij4MAmAqRgIEDGAiOMGAoDseAiFAfiBHkJBphAHAICQGZ0MQMBmEYRgaC8QQIJ4EiEkYGB+JwEAaDrLBGHYf00DgSzN2MqMkDdfyrMQQwKLshynJAFy3I81LvN85zuEhKAIBwYooD8kBXLAYrEDdcg+Ui0zKtipAokSkAAFUDX9MNfjyB5+leKsqhqOoMgIOAYD4UQ1DkOQKirBg8FoNpJtDW0uotKNBCWxt6nAzsSrSxh3MkzKfIikykAS8LEAATls1rEDlIQ5D4FJ1jrPgBAAdwqQ8Zqm36tuqWoKmG+RYLQdZqnkdpBNCeBEOc+hXIOjKvJOmqzvihrEH-Wz7MchGkcOp9juy1LcvYfLCt0kqyoqqr0ai7GsZmcyOLkqUACV4BwZ6GN0aG1F+6b+rsWi0HowV4dSxH0qO1HfIZuqcYsuKRUSvGUv2omXRJvbyYSSmippmByui6qglqpA1cumYbOa5c4PkBoefw0hgZGsaGAmoWZH+qV5raFYTewDoBOE0Spa1lGstOxnrbigB2XHkoJ2XiflvWwDygqjZoWmzcVpAk5V6yyHtkcqPUwRVNGvmRsjmXkblmPC8QJrLpu9WU+lwno5OnKs4pnPqbzk26fNoyMc7m3WdkjXU6b9OY4H7OqeK0fTcqieQEtxAWeZu22fnnu051jOV6Htfjc3+mLYx23mbLo-u6j5v+7JweDeH9fSrHgu78ZjMGKJc94JWfvjE+i8z7LwsvQQKwV6ChXCmoSgaggA
\begin{tikzcd}[row sep=huge, column sep=small]
                                                                                                                                                                                                   &  & {FinProb(-,(X,\mu))} \arrow[rr, maps to]                                                                                                &  & {BProbAlg((X,\mu),(I,\lambda))}                                                                                                                  &  &                                                                                                                                            &  & \substack{\bigsqcup_{\mu\text{ is a measure on }X}\\ \\FinProb(-,(X,\mu))}                            \\
{\text{Sh}(\mathcal{C}_{\mathbb{T}_{cbprop}},J_\mathbb{T})} \arrow[rr, dotted, bend left, leftrightarrow] \arrow[dd, "\substack{U_{\mathbb{T}_{cbrob}}\text{ is a conser-}\\ \text{vative }\mathbb{T}_{atomb}\text{ model}}"] &  & {\text{Sh}(FinProb,J_{at})} \arrow[dd, "\substack{U:FinProb\rightarrow FinSur \\ \text{ is a comorphism of sites}}"] \arrow[rr, dotted, bend left, leftrightarrow] &  & {\text{Cont}_{\tau}(\text{Aut}_{BProbAlg}(I,\lambda))} \arrow[dd, "\substack{\text{Restriction of} \\ \text{ group action}}"] \arrow[rr, dotted, bend left, leftrightarrow] &  & {\text{Sh}(FinProb_{at},J_{at})} \arrow[dd, "\substack{\text{Symmetric, conserva-} \\ \text{tive extension of ZFA}}"] \arrow[rr, dotted, bend left, leftrightarrow] &  & {\text{Sh}_{\text{Sh}(FinSur,J_{at})}(\mathbb{M})} \arrow[dd, "\text{Global sections}"align=right] \\
                                                                                                                                                                                                   &  &                                                                                                                                         &  &                                                                                                                                                  &  &                                                                                                                                            &  &                                                                                         \\
{\text{Sh}(\mathcal{C}_{\mathbb{T}_{atomb}},J_\mathbb{T})} \arrow[rr, dotted, bend left, leftrightarrow]                                                                                                           &  & {\text{Sh}(FinSur,J_{at})} \arrow[rr, dotted, bend left, leftrightarrow]                                                                                &  & \text{Cont}_{\tau}(\text{Aut}_{Bool}(I)) \arrow[rr, dotted, bend left, leftrightarrow]                                                                           &  & {\text{Sh}(FinSur_{at},J_{at})} \arrow[rr, dotted, bend left, leftrightarrow]                                                                              &  & {\text{Sh}(FinSur,J_{at})}                                                              \\
                                                                                                                                                                                                   &  & {FinSur(-,X)} \arrow[rr, maps to]                                                                                                       &  & {Bool(X,I)}                                                                                                                                      &  &                                                                                                                                            &  & {FinSur(-,X)}                                                                           \\
\text{Model theory}                                                                                                                                                                                &  & \text{Combinatorics}                                                                                                                    &  & \text{Group actions}                                                                                                                             &  & \text{Models of ZFA}                                                                                                                       &  & \text{Internal locale}                                                                 
\end{tikzcd}
\end{landscape}





\end{document}